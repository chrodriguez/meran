[% INCLUDE "intranet-top.inc" %]

<script type="text/javascript" src="/intranet-tmpl/includes/circulacion-min.js"></script>

<script language=javascript>
function todos(){
	var checks=document.getElementsByTagName("input");
	if (checks.length>0){
		for(i=0;i<checks.length;i++){
			if(checks[i].type == "checkbox"){
        			if(checks[i].checked){checks[i].checked=false}
				else{checks[i].checked=true}
			}
		}
	}
}

var objAH;//Objeto AjaxHelper.
var ORDEN;//orden
/*
 * borrarDiv
 * Borra el div 
 */
function borrarDiv(){$("#divResultado").html("");}

/*
 * mostrarSanciones
 * Busca todas las sanciones.
 */
function mostrarSanciones(){
	objAH               = new AjaxHelper(updateMostrarSanciones);
	objAH.debug         = true;
    objAH.showOverlay   = true;
    objAH.orden         = ORDEN;
	objAH.url           = "/cgi-bin/koha/circ/sancionesDB.pl";
	objAH.accion        = 'MOSTRAR_SANCIONES'
	objAH.sendToServer();
}
function updateMostrarSanciones(responseText){
	$("#divResultado").html(responseText);
    zebra('datos_tabla');

}

function ordenar(orden){
    ORDEN = orden;
    mostrarSanciones();
}

function borrarSanciones(chck){

    var chck  = $("input[@name="+chck+"]:checked");
    var array = new Array;
    var long  = chck.length;
    if ( long == 0){
        jConfirm("Elija al menos una sancion para eliminar");
    }
    else{

        jConfirm(ESTA_SEGURO_QUE_DESEA_CANCELAR_LA_SANCION,SANCIONES_TITLE, function(confirmStatus){if (confirmStatus) {

            for(var i=0; i< long; i++){
              array[i]=chck[i].value;
            }

            objAH               = new AjaxHelper(updateSanciones);
            objAH.debug         = true;
            objAH.showOverlay   = true;
            objAH.url           = '/cgi-bin/koha/circ/sancionesDB.pl';
            objAH.accion        = "ELIMINAR_SANCIONES"
            objAH.datosArray    = array;

            objAH.sendToServer();
        }

        });
    }
}


function updateSanciones(responseText){

	borrarDiv();	
    if (!verificarRespuesta(responseText)){
        return(0);
    }        
    var Messages = JSONstring.toObject(responseText);
    setMessages(Messages);
	mostrarSanciones();
}


$(document).ready( function() {
	mostrarSanciones();
	onEnter("buscar",buscarSancion);
});



/************************************************************* BUSQUEDA DE SANCIONES *************************************************/


/*
 * buscarSancion
 * Busca todas las sanciones o las que se corresponden con el string ingresado para filtrar la busqueda.
 */
function buscarSancion(){
	objAH               = new AjaxHelper(updateBuscaSancion)
	objAH.debug         = true
	objAH.showOverlay   = true;
	objAH.url           = "/cgi-bin/koha/circ/sancionesDB.pl";
	objAH.string        = $("#buscar").val()
	objAH.accion        = "BUSCAR_SANCIONES"
	objAH.sendToServer()
}

function updateBuscaSancion(responseText){
	$("#divResultado").html(responseText);
	zebra('datos_tabla');
}


/*
 * limpiar
 * Borra el texto ingresado en el componente de busqueda.
 */
function limpiar(){
    $("#buscar").val("")
}



</script>

<fieldset id="reportes">
    <legend class="titulo_legend"> <span class="titulos">[% "Administraci&oacute;n de Sanciones del Sistema" | i18n %] </span> </legend>
    
    <ul>
        <li class="sub_item">
            <input type="text" id="buscar" name="buscar" value="">
            [% PERL %]
                 print C4::AR::Filtros::setHelp(text => "[% 'Ingrese el Apellido, Nombre o Numero de Socio.' | i18n %]",
                                                );
            [% END %]
            [% PERL %]
                                print C4::AR::Filtros::to_Button(   text    => "[% 'Buscar' | i18n %]",
                                                                    boton   => "boton_buscar",
                                                                    onClick => "buscarSancion();",
                                                                    title   => "[% 'Buscar' | i18n %]",
                                        ) ;
            [% END %]
        
            [% PERL %]
                                print C4::AR::Filtros::to_Button(   text    => "[% 'Limpiar' | i18n %]",
                                                                    boton   => "boton_borrar",
                                                                    onClick => "limpiar();",
                                                                    title   => "[% 'Limpiar' | i18n %]",
                                        ) ;
            [% END %]
        </li>
    </ul>
</fieldset>

<fieldset class="resultados_busqueda">
    <legend class="titulo_legend">[% "Sanciones" | i18n %]</legend>
    <div id="divResultado"></div>
</fieldset>
[% INCLUDE "intranet-bottom.inc" %]
