
-- No se usa esta tabla
drop table users;

-- Se renombro la tabla

RENAME TABLE usr_socios  TO usr_socio;

--Se deja el id_persona en usr_socio
ALTER TABLE `usr_persona`  DROP `id_socio`;

--se modifico el campo
ALTER TABLE `usr_persona` CHANGE `vesion_documento` `version_documento` CHAR( 1 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL DEFAULT 'P' ;

--se modificaron los campos


ALTER TABLE `usr_socio` CHANGE `lastlogin` `last_login` DATETIME NULL DEFAULT NULL ,
CHANGE `lastchangepassword` `last_change_password` DATE NULL DEFAULT NULL ,
CHANGE `changepassword` `change_password` TINYINT( 1 ) NOT NULL DEFAULT '0';

ALTER TABLE `usr_persona` ADD `activo` tinyint( 1 ) unsigned NOT NULL default '1';

ALTER TABLE `usr_estado` ADD `id_estado` INT( 11 ) NOT NULL AUTO_INCREMENT PRIMARY KEY FIRST ;
ALTER TABLE `usr_estado` ADD UNIQUE (`id_persona` ,`fuente`);


--RENAMES si no lo hacen no anda nada!!!--

RENAME TABLE userflags TO usr_permiso;
RENAME TABLE sessions TO sist_sesion;
RENAME TABLE systempreferences TO pref_preferencia_sistema;
--


NO RENOMBRE LA TABLA CATEGORIES PARA NO ROMPER TODO, SE EXPORTO LA INFO Y SE MODIFICO EL NOMBRE DE LA TABLA
HAY 2 TABLAS AHORA, MAS ADELANTE SE ELIMINA CATEGORIES

CREATE TABLE `usr_ref_categoria_socio` (
  `categorycode` char(2) NOT NULL default '',
  `description` text,
  `enrolmentperiod` smallint(6) default NULL,
  `upperagelimit` smallint(6) default NULL,
  `dateofbirthrequired` tinyint(1) default NULL,
  `finetype` varchar(30) default NULL,
  `bulk` tinyint(1) default NULL,
  `enrolmentfee` decimal(28,6) default NULL,
  `overduenoticerequired` tinyint(1) default NULL,
  `issuelimit` smallint(6) default NULL,
  `reservefee` decimal(28,6) default NULL,
  `borrowingdays` smallint(30) NOT NULL default '14',
  UNIQUE KEY `categorycode` (`categorycode`)
) ENGINE=innodb DEFAULT CHARSET=latin1;

-- 
-- Volcar la base de datos para la tabla `categories`
-- 

INSERT INTO `usr_ref_categoria_socio` (`categorycode`, `description`, `enrolmentperiod`, `upperagelimit`, `dateofbirthrequired`, `finetype`, `bulk`, `enrolmentfee`, `overduenoticerequired`, `issuelimit`, `reservefee`, `borrowingdays`) VALUES 
('ES', 'Estudiante', 0, 55, 18, NULL, NULL, 0.000000, 0, 0, 0.000000, 14),
('IN', 'Investigador', 15, 100, 0, NULL, NULL, 0.000000, 0, 8, 0.000000, 14),
('DO', 'Docente', 10, 80, 0, NULL, NULL, 0.000000, 1, 5, 0.000000, 14),
('ND', 'No Docente', 10, 0, 0, NULL, NULL, 0.000000, 1, 3, 0.000000, 14),
('EG', 'Egresado', 10, 0, 0, NULL, NULL, 0.000000, 1, 3, 0.000000, 14),
('PG', 'Postgrado', NULL, 90, NULL, NULL, NULL, NULL, 1, 3, NULL, 14);

ALTER TABLE `usr_ref_categoria_socio` ADD PRIMARY KEY ( `categorycode` ) ;

ALTER TABLE usr_socio ADD FOREIGN KEY(id_persona) REFERENCES usr_persona(id_persona);



-- LOS BRANCHES


CREATE TABLE `pref_unidad_informacion` (
  `branchcode` varchar(4) NOT NULL default '',
  `branchname` text NOT NULL,
  `branchaddress1` text,
  `branchaddress2` text,
  `branchaddress3` text,
  `branchphone` text,
  `branchfax` text,
  `branchemail` text,
  `issuing` tinyint(4) default NULL,
  UNIQUE KEY `branchcode` (`branchcode`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

-- 
-- Volcar la base de datos para la tabla `branches`
-- 

INSERT INTO `pref_unidad_informacion` (`branchcode`, `branchname`, `branchaddress1`, `branchaddress2`, `branchaddress3`, `branchphone`, `branchfax`, `branchemail`, `issuing`) VALUES 
('DEO', 'Facultad de Ciencias Económicas', '6 entre 47 y 48. 1° subusuelo', '', '', '0221-423-6771/6769', '', 'biblio@econo.unlp.edu.ar', NULL),
('DIF', 'Facultad de Informática', '115 esquina 50. 1° subusuelo', '', '', '', '', 'biblioteca@info.unlp.edu.ar', NULL),
('CD', 'Centro de Documentación', '7 Nº 445', '', '', '', '', '', NULL);

ALTER TABLE `pref_unidad_informacion` DROP `issuing` ;
ALTER TABLE `pref_unidad_informacion` DROP `branchaddress3` ;

ALTER TABLE `pref_unidad_informacion` CHANGE `branchemail` `email`  VARCHAR( 255 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL
ALTER TABLE `pref_unidad_informacion` CHANGE `branchfax` `fax`  VARCHAR( 255 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL  DEFAULT NULL 
 ALTER TABLE `pref_unidad_informacion` CHANGE `branchcode` `id_ui` VARCHAR( 4 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL ,
CHANGE `branchname` `nombre`  VARCHAR( 255 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL ,
CHANGE `branchaddress1` `direccion`  VARCHAR( 255 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL ,
CHANGE `branchaddress2` `alt_direccion`  VARCHAR( 255 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL ,
CHANGE `branchphone` `telefono`  VARCHAR( 255 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL 

ALTER TABLE `pref_unidad_informacion` ADD PRIMARY KEY ( `id_ui` )


-- Se creo una nueva preferencia, el 'defaultBranch' se conserva para que no se rompa nada, despues se borra

INSERT INTO `pref_preferencia_sistema` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES (
'defaultUI', 'DEO', 'Unidad de informacion por defecto', NULL , NULL
); 



INSERT INTO `pref_preferencia_sistema` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES (
'defaultTipoDoc', 'DNI', 'Tipo de Documento por defecto', NULL , NULL
); 


INSERT INTO `pref_preferencia_sistema` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES (
'defaultCategoriaSocio', 'ES', 'Categoria de Socio por defecto', NULL , NULL
); 

