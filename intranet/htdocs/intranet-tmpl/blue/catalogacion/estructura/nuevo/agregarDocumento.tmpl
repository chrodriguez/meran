[% INCLUDE "intranet-top.inc" %]

<!-- Se incluyen las librerias necesarias para manejar autocomplete -->
[% INCLUDE "AutocompleteHelper.inc" %]

<script src="/intranet-tmpl/blue/includes/CombosHelper.js"></script> 
<!-- para manejar la ventana de campos MARC -->
<script src="/intranet-tmpl/blue/includes/popups/helpCamposMARC.js"></script>

<script>

//************************************************REVISADO******************************************************************
id1=0; //para saber el id del nivel 1
id2=0; //para saber el id del nivel 2
id3=0; //para saber el id del nivel 3
dataModif = new Array();
modificar = 0;
// array_info_combo= 0; //para guardar las opciones de los combos que se generan en el cliente

//arreglo de objetos componentes, estos objetos son actualizados por el usuario y luego son enviados al servidor
COMPONENTES_ARRAY= new Array();

function inicializar(){
    //arreglo de objetos campo
    COMPONENTES_ARRAY= new Array();
    dataModif = new Array();
}


function armarValidador(){
   
   for(var i=0; i < COMPONENTES_ARRAY.length; i++){
         if (COMPONENTES_ARRAY[i].obligatorio)
             $('#'+COMPONENTES_ARRAY[i].idCompCliente).addClass('required ');
      }
}

//esta funcion sincroniza la informacion del cliente con el arreglo de componentes para enviarlos al servidor
function syncComponentesArray(){
    for(var i=0; i < COMPONENTES_ARRAY.length; i++){
       COMPONENTES_ARRAY[i].dato= $('#'+COMPONENTES_ARRAY[i].idCompCliente).val();
    }
}

//para mantener el nivel que se esta procesando
_nivelActual= 1;

function getDivDelNivel(){
    
    switch(_nivelActual){
        case 1:
            return 'estructuraDelNivel1';   
        break;
        case 2:
            return 'estructuraDelNivel2';
        break;
        case 3:
            return 'estructuraDelNivel3';
        break;
    }
}


// FIXME esto podria ser generico para los 3 niveles
function mostrarEstructuraDelNivel1(){
    _nivelActual= 1;
    $("#nivel1Tabla").show();
    $("#nivel2Tabla").hide();
    $("#nivel3Tabla").hide();
    objAH=new AjaxHelper(updateMostrarEstructuraDelNivel1);
    objAH.debug= true;
    objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
    objAH.tipoAccion= "MOSTRAR_ESTRUCTURA_DEL_NIVEL";
    objAH.nivel= _nivelActual;
    
    objAH.id_tipo_doc= 'ALL';//$("#tipo_nivel3_id").val();
    objAH.sendToServer();
}



function mostrarDataNivel1(){

    if (modificar){
        //se recupera y setea la info de los campos fijos del nivel 1
        $('#titulo').val(dataModif[0].cat_nivel1.titulo);
        $('#autor').val(dataModif[0].cat_nivel1.cat_autor[0].completo);
        $('#autor_hidden').val(dataModif[0].cat_nivel1.autor);

        for (x=0; x<dataModif.length; x++){
            $('#'+dataModif[x].CEC.idCompCliente).val(dataModif[x].dato);
            COMPONENTES_ARRAY[x].rep_n1_id = dataModif[x].rep_n1_id;
        }
   }
   armarValidador();
}

function updateMostrarEstructuraDelNivel1(responseText){
    _clearContentsEstructuraDelNivel();
    _showAndHiddeEstructuraDelNivel(1);
    //proceso la info del servidor y se crean las componentes en el cliente
    //ademas se carga el arreglo COMPONENTES_ARRAY donde se hace el mapeo de componente del cliente y dato
    procesarInfoJson(responseText); 
    //carga los datos en los campos solo si se esta modificando
    mostrarDataNivel1();
}

function mostrarEstructuraDelNivel2(){
    objAH=new AjaxHelper(updateMostrarEstructuraDelNivel2);
    objAH.debug= true;
    objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
    objAH.tipoAccion= "MOSTRAR_ESTRUCTURA_DEL_NIVEL";
    objAH.nivel= 2;
    objAH.id_tipo_doc= $("#tipo_nivel3_id").val();
    objAH.sendToServer();
}

function updateMostrarEstructuraDelNivel2(responseText){
    _clearContentsEstructuraDelNivel();
    _showAndHiddeEstructuraDelNivel(2);
    //proceso la info del servidor y se crean las componentes en el cliente
    procesarInfoJson(responseText);
    armarValidador();

}

function mostrarEstructuraDelNivel3(){
    _nivelActual= 3;

    objAH=new AjaxHelper(updateMostrarEstructuraDelNivel3);
    objAH.debug= true;
    objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
    objAH.tipoAccion= "MOSTRAR_ESTRUCTURA_DEL_NIVEL";
    objAH.nivel= _nivelActual;
    objAH.id_tipo_doc= $("#tipo_nivel3_id").val();
    objAH.sendToServer();
}

function _clearContentsEstructuraDelNivel(){
    $("#estructuraDelNivel1").html("");
    $("#estructuraDelNivel2").html("");
    $("#estructuraDelNivel3").html("");
}

// muestra/oculta los divs de la estructura segun el nivel que se este procesando
function _showAndHiddeEstructuraDelNivel(nivel){
    if(nivel == 1){
        $('#nivel1Tabla').show();
        $('#nivel2Tabla').hide();
        $('#nivel3Tabla').hide();
    }else if(nivel == 2){
        $('#nivel2Tabla').show();
        $('#nivel1Tabla').hide();
        $('#nivel3Tabla').hide();
    }else if(nivel == 3){
        $('#nivel3Tabla').show();
        $('#nivel1Tabla').hide();
        $('#nivel2Tabla').hide();
    }
}

function updateMostrarEstructuraDelNivel3(responseText){
    _clearContentsEstructuraDelNivel();
    _showAndHiddeEstructuraDelNivel(3);
    //proceso la info del servidor y se crean las componentes en el cliente
    procesarInfoJson(responseText);
    armarValidador();
}

//esta funcion muestra la info en la barra laterarl del NIVEL 1 luego de ser guardado
function mostrarInfoAltaNivel1(id1){
    objAH=new AjaxHelper(updateMostrarInfoAltaNivel1);
    objAH.debug= true;
    objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
    objAH.tipoAccion= "MOSTRAR_INFO_NIVEL1_LATERARL";
    objAH.id1= id1;
    objAH.sendToServer();
}

function updateMostrarInfoAltaNivel1(responseText){
    $('#nivel1Tabla').slideUp('slow');
    $('#estructuraDelNivel1').html('');
    $('#nivel1').html(responseText);
}

//esta funcion muestra la info en la barra laterarl del NIVEL 2 luego de ser guardado
function mostrarInfoAltaNivel2(id2){
    objAH=new AjaxHelper(updateMostrarInfoAltaNivel2);
    objAH.debug= true;
    objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
    objAH.tipoAccion= "MOSTRAR_INFO_NIVEL2_LATERARL";
    objAH.id2= id2; //voy a mostrar todos los nivel 2 del nivel1 con el q se esta trabajando, asi este vuela
    objAH.id1= id1;
    objAH.sendToServer();
}

function updateMostrarInfoAltaNivel2(responseText){
    $('#nivel2Tabla').slideUp('slow');
    $('#estructuraDelNivel2').html('');
    $('#nivel2').html(responseText);
}

function guardarDocumentoN1(){

    syncComponentesArray();
    objAH=new AjaxHelper(updateGuardarDocumentoN1);
    objAH.debug= true;
    objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
    objAH.tipoAccion= "GUARDAR_NIVEL_1";
    objAH.id_tipo_doc= $("#tipo_nivel3_id").val();
    //seteo valores a los campos fijos del nivel 1
    objAH.titulo= $("#titulo").val();
    objAH.autor= $("#autor_hidden").val();

    objAH.hayRepetibles= COMPONENTES_ARRAY.length;
    objAH.infoArrayNivel1= COMPONENTES_ARRAY;
    objAH.modificado = modificar;
    objAH.id1 = id1;
    objAH.sendToServer();
    modificar = 0;
}

function updateGuardarDocumentoN1(responseText){

    var info=JSONstring.toObject(responseText);
    var Messages= info.Message_arrayref;
    id1= info.id1;
    setMessages(Messages);
    if (! (hayError(Messages) ) ){
        inicializar();
        //carga la barra lateral con info de nivel 1
        mostrarInfoAltaNivel1(id1);
        mostrarEstructuraDelNivel2();
    }
}

function guardarDocumentoN2(){
    syncComponentesArray();
    objAH=new AjaxHelper(updateGuardarDocumentoN2);
    objAH.debug= true;
    objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
    objAH.tipoAccion= "GUARDAR_NIVEL_2";
    //seteo valores a los campos fijos del nivel 2
    objAH.nivel_bibliografico= $("#nivel_bibliografico_hidden").val();
    objAH.soporte= $("#soporte_hidden").val();
    objAH.pais_publicacion= $("#pais_publicacion_hidden").val();
    objAH.lenguaje= $("#lenguaje_hidden").val();
    objAH.ciudad_publicacion= $("#ciudad_publicacion_hidden").val();
    objAH.anio_publicacion= $("#anio_publicacion").val();
    objAH.tipo_documento= $("#tipo_nivel3_id").val();

    objAH.hayRepetibles= COMPONENTES_ARRAY.length;
    objAH.infoArrayNivel2= COMPONENTES_ARRAY;
    objAH.modificado = modificar;
    objAH.id1 = id1;
    objAH.id2 = id2; //por si se modificÃ³
    objAH.sendToServer();
}

function updateGuardarDocumentoN2(responseText){

    var info=JSONstring.toObject(responseText);
    var Messages= info.Message_arrayref;//obtengo los mensajes para el usuario
    id2= info.id2;
    setMessages(Messages);
    if (! (hayError(Messages) ) ){
        inicializar();
        //carga la barra lateral con info de nivel 1
        mostrarInfoAltaNivel2(id2);
        mostrarEstructuraDelNivel3();
    }
}


function guardarDocumentoN3(){
    syncComponentesArray();
    objAH=new AjaxHelper(updateGuardarDocumentoN3);
    objAH.debug= true;
    objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
    objAH.tipoAccion= "GUARDAR_NIVEL_3";
    //seteo valores a los campos fijos del nivel 3
    objAH.barcode= $("#barcode").val();
    objAH.sig_topografica= $("#signatura_topografica").val();
    objAH.id_ui_poseedora= $("#id_ui_poseedora").val();
    objAH.id_ui_origen= $("#id_ui_origen").val();

    objAH.tipo_documento= $("#tipo_nivel3_id").val();
    objAH.hayRepetibles= COMPONENTES_ARRAY.length;
    objAH.infoArrayNivel2= COMPONENTES_ARRAY;
    objAH.id1 = id1;
    objAH.id2 = id2;
    objAH.sendToServer();
}

function updateGuardarDocumentoN3(responseText){

    var info=JSONstring.toObject(responseText);
    var Messages= info.Message_arrayref; //obtengo los mensajes para el usuario
    id3= info.id3;
    setMessages(Messages);

   //PARA LIMPIAR EL VALUE DE TODOS (ASI INGRESA UNO NUEVO)
   var allInputs = $('#estructuraDelNivel3 :input');
       for (x=0; x< allInputs.length; x++)
            allInputs[x].value="";
    if (! (hayError(Messages) ) ){
        inicializar();
        //muestra la tabla con los ejemplares agregados
        mostrarInfoAltaNivel3(info.id1, info.id2);
    }
}

//esta funcion muestra la info en la barra laterarl del NIVEL 2 luego de ser guardado
function mostrarInfoAltaNivel3(id1, idNivel2){
    objAH=new AjaxHelper(updateMostrarInfoAltaNivel3);
    objAH.debug= true;
    objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
    objAH.tipoAccion= "MOSTRAR_INFO_NIVEL3_TABLA";
    objAH.id1= id1;
    objAH.id2= idNivel2;
    id2= idNivel2;
    objAH.sendToServer();
}

function updateMostrarInfoAltaNivel3(responseText){
    $('#detalleDelNivel3').html(responseText);
    zebra('tablaResult');
}

/*
 * procesarInfoJson
 * procesa la informacion que esta en notacion json, que viene del llamado ajax.
 * @params
 * json, string con formato json.
 */
function procesarInfoJson(json){
    objetos=JSONstring.toObject(json);
    
    for(var i=0; i< objetos.length; i++){
        //guardo el objeto para luego enviarlo al servidor una vez que este actualizado
        COMPONENTES_ARRAY[i]= objetos[i];
        procesarObjeto(objetos[i]);
    }
}

/*
 * procesarObjeto
 * procesa el objeto json, para poder crear el componente adecuado al tipo de datos que vienen en el objeto.
 * @params
 * objeto, elemento que contiene toda la info necesaria.
 */
function procesarObjeto(objeto){
    var libtext= $.trim(objeto.liblibrarian);
    var tipo= $.trim(objeto.tipo);
    var ref= objeto.referencia;
    var valor= objeto.valor;
    var varios= objeto.varios;
    var idComp= objeto.idCompCliente;
    var comp;
    var hidden=" ";
    var strComp;
    var auto=0;
    var unoLinea=0;
    var idDiv="div"+idComp;
    var divComp= crearDivComponente(idDiv);
    var divLabel= crearDivLabel(libtext);
    strComp="<div class='divContentComponente'> "+divLabel+divComp+"</div>";
    $(strComp).appendTo("#"+getDivDelNivel());

    switch(tipo){
        case "text":
            //tipo,id,opciones,valor
            comp= crearComponente(tipo,idComp,"","");
            $(comp).appendTo("#"+idDiv);
            $("#"+idComp).val(objeto.valText);
            auto= objeto.referencia;
        break;
        case "combo":
//             var opciones= JSONstring.toObject(objeto.opciones);
            comp= crearComponente(tipo,idComp,opciones,valor);
            $(comp).appendTo("#"+idDiv);
        break;
        case "texta2":
            compText=crearComponente("text",idComp,"","");
            comp=crearComponente("texta","texta"+idComp,"readonly='readonly'","");
            var boton="<input type='image' value='borrar ultima opcion' onclick='borrarEleccion("+idComp+")' src='[% themelang %]/images/sacar.png'>";
            comp="<div style='float: left;padding-right:1%; padding-bottom: 1%;'>"+comp+"</div>";
            compText=compText+" "+boton;
            $(compText).appendTo("#"+idDiv);
            $(comp).appendTo("#strComp"+idComp);
            $("#texta"+idComp).val(objeto.valTextArea);
            auto= objeto.referencia;
        break;
    }

    //Se agregan clases para cuando tenga que recuperar los datos.
    if(objeto.obligatorio == "1"){
        hacerComponenteObbligatoria(idComp);
    }
    //Para crear el autocomplete correspondiente
//     if(auto){
//         var tabla=objeto.tabla;
//         var campos=objeto.campos;
//         var orden=objeto.orden;
//         var separador=objeto.separador;
//         crearAuto(idComp,tabla,accion,id,campos,orden,separador);
//     }
}

/*
 * crearComponente
 * crea el string HTML del componente correspondiente al parametro tipo.
 * @params
 * tipo, corresponde a la clase de componente html que se quiere crear.
 * id, identificador para el componente que se va a crear.
 * opciones, son las opciones que se generan si el componente es un combobox, para los demas esta en blanco.
 */
function crearComponente(tipo,id,opciones,valor){
    var comp;

    switch(tipo){
        case "text": comp="<input type='"+tipo+"' id='"+id+"' value='"+valor+"' size='80'>";
        break;
        case "combo": comp="<select id='"+id+"'>\n<option value=''>Elegir opci&oacute;n</option>\n";
            var op="";
            var def="";
            for(var i=0; i< opciones.length; i++){
                if(valor == opciones[i].clave){
                    def=" selected='selected' ";
                }
                op=op+"<option value='"+opciones[i].clave+ "'" + def +"'>"+opciones[i].valor+"</option>\n";
                def="";
            }
            comp=comp+op+"</select>";
        break;
        case "texta": comp="<textarea id='"+id+"' "+ opciones +" rows='4'>"+valor+"</textarea>";
        break;
    }

    return comp;
}


// Esta funcion convierte una componete segun idObj en obligatoria, agrega * a la derecha de la misma
function hacerComponenteObbligatoria(idObj){
    $("#"+idObj).addClass("obligatorio");
    $("<b> * </b>").insertAfter($("#"+idObj));    
}

// Esta funcion crea un divComponente con un id segun parametro idObj
function crearDivComponente(idObj){
    return "<div id='"+idObj+"' class='divComponente'></div>";
}

// Esta funcion crea un divLabel con un Label segun parametro
function crearDivLabel(label){
    return "<div class='divLabelComponente'>  "+label+": </div>";
}


/*
 * borrarN1
 * Elimina de la base de datos el documento con id1 igual al parametro que ingresa y todos los otros datos 
 * correspondiente a los otros niveles que hacen referencia al id1.
 */
function borrarN1(id1){
	$("#result").html("");
	objJSON=new AjaxHelper();
    objJSON.debug= true;
	objJSON.itemtype=$("#id_tipo_doc").val();
	objJSON.paso=1;

	objAH=new AjaxHelper(updateBorrarN1);
   objAH.debug= true;
	objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
	objAH.id1=id1;
	objAH.nivel=1;
	objAH.itemtype=$("#id_tipo_doc").val();
	objAH.tipoAccion="ELIMINAR_NIVEL";
	objAH.sendToServer();
}

function updateBorrarN1(responseText){
    var info=JSONstring.toObject(responseText);  
    mostrarEstructuraDelNivel2();
    var Messages= info.Message_arrayref;
    setMessages(Messages);
}
/*
 * modificarN1
 * Funcion que obtiene los datos ingresados en el nivel 1 para poder crear los componentes con los valores
 * guardados en la base de datos y poder modificarlos.
 */
function modificarN1(id1){
   inicializar();
	$("#result").html("");
	objAH=new AjaxHelper(updateModificarN1);
   objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
   objAH.debug= true;
	objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL_CON_DATOS";
	objAH.itemtype="ALL";
   objAH.id = id1;
   objAH.nivel = 1;
	objAH.sendToServer();
}

function updateModificarN1(responseText){
    modificar = 1;
    //se genera un arreglo de objetos con la informacion guardada, campo, subcampo    
    dataModif = JSONstring.toObject(responseText);
    mostrarEstructuraDelNivel1();
}

function modificarN2(id2){
   inicializar();
   $("#result").html("");
   objAH=new AjaxHelper(updateModificarN2);
   objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
   objAH.debug= true;
   objAH.tipoAccion="MOSTRAR_ESTRUCTURA_DEL_NIVEL_CON_DATOS";
   objAH.itemtype=$("#id_tipo_doc").val();
   objAH.id = id2;
   objAH.nivel = 2;
   objAH.sendToServer();
}

function updateModificarN2(responseText){
   modificar = 1;
   dataModif = JSONstring.toObject(responseText);
   mostrarEstructuraDelNivel2();
}
/*
 * borrarGrupo
 * Elimina de la base de datos el grupo correspodiente a los parametros que ingresan, y los ejemplares que hay en 
 * ese grupo.
 */
function borrarGrupo(id1,id2){
	$("#result").html("");
	
	objJSON=new AjaxHelper();
    objJSON.debug= true;
	objJSON.itemtype=$("#id_tipo_doc").val();
	objJSON.paso=2;
	
	objAH=new AjaxHelper(updateBorrarGrupo);
    objAH.debug= true;
	objAH.url="/cgi-bin/koha/catalogacion/estructura/nuevo/estructuraCataloDB.pl";
	objAH.id2=id2;
	objAH.nivel=2;
	objAH.itemtype=$("#id_tipo_doc").val();
	objAH.tipoAccion="ELIMINAR_NIVEL";
	objAH.sendToServer();
}

function updateBorrarGrupo(){
}


//Funcion que se ejecuta cuando se carga la pagina, dependiendo de donde viene ejecuta las funciones correspondientes.
$(document).ready( function() {
    //autocomplete nivel 1
    CrearAutocompleteCiudades('autor', 'autor_hidden', '/cgi-bin/koha/autocompletables/autorAutocomplete.pl');

    //autocomplete nivel 2
    CrearAutocompletePaises(    'nivel_bibliografico', 
                                'nivel_bibliografico_hidden', 
                                '/cgi-bin/koha/autocompletables/nivelBibliograficoAutocomplete.pl'
                        );
    CrearAutocompletePaises('soporte', 'soporte_hidden', '/cgi-bin/koha/autocompletables/soportesAutocomplete.pl');
    CrearAutocompletePaises('pais_publicacion', 'pais_publicacion_hidden', '/cgi-bin/koha/autocompletables/paisesAutocomplete.pl');
    CrearAutocompleteLenguajes('lenguaje', 'lenguaje_hidden', '/cgi-bin/koha/autocompletables/lenguajesAutocomplete.pl');
    CrearAutocompleteCiudades('ciudad_publicacion', 'ciudad_publicacion_hidden', '/cgi-bin/koha/autocompletables/searchcity.pl');

} );

</script>

<div style="text-align: right;"><span class="click" onClick="abrirVentanaHelperMARC();">Ayuda MARC</span></div>

<p class="pagetitle" >[% "Agregar Documento" | i18n %]</p>

[% "Esquema de ingreso de datos tipo:" | i18n %] [% selectItemType %]
<br><br>

<div class="todo">

<div class="lateral">
    <div id="nivel1" class="nivel1Lateral"></div>
    <div class="nivel2Barra">
        <div id="nivel2" class="nivel2Lateral"></div>
    </div>
</div>   <!--END <div class="lateral">-->

<div class="centro">

<span id="nivel1Tabla">
    <table width="100%" cellspacing="0" cellpadding="0" border="0">
        <tr class="tablaresultadoTitle">
            <td width="1%" align="left" valign="top">
                <img src="[% themelang %]/images/izquierda.png">
            </td>
            <td colspan="7" class=inputFontNormal> 
                    <b>[% "Agregar Documento:" | i18n %] [% descripcion %]  (paso: 1 de 3) </b>
            </td>
            <td width="1%" align="right" valign="top">
                <img src="[% themelang %]/images/derecha.png">
            </td>
        </tr>
    </table>

<!--     CAMPOS FIJOS DEL NIVEL 1 -->
    <div class="divContentComponente">
    <div class="divLabelComponente"> T&iacute;tulo: </div>
        <div id="divTitulo" class="divComponente">
            <input id="titulo" class="obligatorio" type="text" size="80" value=""/><b> * </b>
        </div>
    </div>
    
    <div class="divContentComponente">
    <div class="divLabelComponente"> Autor: </div>
        <div id="divTitulo" class="divComponente">
            <input id="autor" name="autor" class="obligatorio" type="text" size="80" value=""/><b> * </b>
            <input id="autor_hidden" value="" type="hidden">
        </div>
    </div>
<!--     CAMPOS DINAMICOS DEL NIVEL1 -->
    <div id= "estructuraDelNivel1"></div>

    <br>
    <p><b>&nbsp;* [% "Campos obligatorios" | i18n %]</b></p>
    
    <center>
    <input  type="image" src="[% themelang %]/images/guardar.png" value="[% 'Guardar nivel 1' | i18n %]" title="[% 'Guardar nivel 1' | i18n %]"  
            onClick="guardarDocumentoN1()">
    </center>
</span>

<span id="nivel2Tabla">
    <table width="100%" cellspacing="0" cellpadding="0" border="0">
        <tr class="tablaresultadoTitle">
            <td width="1%" align="left" valign="top">
                <img src="[% themelang %]/images/izquierda.png">
            </td>
            <td colspan="7" class=inputFontNormal> 
                    <b>[% "Agregar Grupo:" | i18n %] [% descripcion %]  (paso: 2 de 3) </b>
            </td>
            <td width="1%" align="right" valign="top">
                <img src="[% themelang %]/images/derecha.png">
            </td>
        </tr>
    </table>
    
<!-- FIXME Ver si es necesario -->
   <!-- <div class="divContentComponente">
        <div class="divLabelComponente">  Tipo de Documento: </div>
            <div id="divTipoDocumento" class="divComponente">[% comboTipoDocumento %]</div>
    </div>-->

    <div class="divContentComponente"> 
        <div class="divLabelComponente">  Nivel Bibliogr&aacute;fico: </div>
            <div id="divNivelBibliografico" class="divComponente">
                <input id="nivel_bibliografico" value="" size="80" type="text">
                <input id="nivel_bibliografico_hidden" value="" size="80" type="hidden">
            </div>
    </div>

    <div class="divContentComponente">
        <div class="divLabelComponente">  Soporte: </div>
            <div id="divSoporte" class="divComponente">
                <input id="soporte" name="soporte" value="" size="80" type="text">
                <input id="soporte_hidden" value="" type="hidden">
            </div>
    </div>

    <div class="divContentComponente"> 
        <div class="divLabelComponente">  Pais de Publicaci&oacute;n: </div>
            <div id="divPaisPublicacion" class="divComponente">
                <input id="pais_publicacion" name="pais_publicacion" value="" size="80" type="text">
                <input id="pais_publicacion_hidden" value="" type="hidden">
            </div>
    </div>

    <div class="divContentComponente"> 
        <div class="divLabelComponente">  Lenguaje: </div>
            <div id="divLenguaje" class="divComponente">
                <input id="lenguaje" name="lenguaje" value="" size="80" type="text">
                <input id="lenguaje_hidden" value="" type="hidden">
            </div>
    </div>
    
    <div class="divContentComponente">
        <div class="divLabelComponente">  Ciudad de Publicaci&oacute;n: </div>
            <div id="divCiudadPublicacion" class="divComponente">
                <input id="ciudad_publicacion" name="ciudad_publicacion" value="" size="80" type="text">
                <input id="ciudad_publicacion_hidden" value="" type="hidden">
            </div>
    </div>

    <div class="divContentComponente">
        <div class="divLabelComponente">  A&ntilde;o de Publicaci&oacute;n: </div>
            <div id="divAnioPublicacion" class="divComponente">
                <input id="anio_publicacion" value="" size="10" type="text">
            </div>
    </div>

<!--     CAMPOS DINAMICOS DEL NIVEL 2 -->
    <div id= "estructuraDelNivel2"></div>

    <br>
    <p><b>&nbsp;* [% "Campos obligatorios" | i18n %]</b></p>
    
    <center>
    <input  type="image" src="[% themelang %]/images/guardar.png" value="[% 'Guardar nivel 2' | i18n %]" title="[% 'Guardar nivel 1' | i18n %]"  
            onClick="guardarDocumentoN2()">
    </center>
</span>

<span id="nivel3Tabla">
    <table width="100%" cellspacing="0" cellpadding="0" border="0">
        <tr class="tablaresultadoTitle">
            <td width="1%" align="left" valign="top">
                <img src="[% themelang %]/images/izquierda.png">
            </td>
            <td colspan="7" class=inputFontNormal> 
                    <b>[% "Agregar Ejemplar:" | i18n %] [% descripcion %]  (paso: 3 de 3) </b>
            </td>
            <td width="1%" align="right" valign="top">
                <img src="[% themelang %]/images/derecha.png">
            </td>
        </tr>
    </table>

<!--     CAMPOS FIJOS DEL NIVEL 3   -->
    <div class="divContentComponente"> 
        <div class="divLabelComponente">  Codigo de Barra: </div>
        <div id="divCodigoBarra" class="divComponente">
            <input class="obligatorio" id="barcode" value="" size="80" type="text"><b> * </b>
        </div>
    </div>
    <div class="divContentComponente"> 
        <div class="divLabelComponente">  Signatura Topografica: </div>
        <div id="divSignaturaTopografica" class="divComponente">
            <input class="obligatorio" id="signatura_topografica" value="" size="80" type="text"><b> * </b>
        </div>
    </div>
    <div class="divContentComponente"> <div class="divLabelComponente">  UI Poseedora: </div>
        <div id="divUIPoseedora" class="divComponente">
            [% selectUIPoseedora %]<b> * </b>
        </div>
    </div>
    <div class="divContentComponente"> <div class="divLabelComponente">  UI Origen: </div>
        <div id="divUIOrigen" class="divComponente">
            [% selectUIOrigen %]<b> * </b>
        </div>
    </div>
    <div class="divContentComponente"> <div class="divLabelComponente">  Para Sala: </div><div id="divParaSala" class="divComponente">
        Si<input type=radio class="obligatorio" name="para_sala" value="1">
        No<input type=radio class="obligatorio" name="para_sala" value="0">
        <b> * </b></div>
    </div>

<!--     CAMPOS DINAMICOS DEL NIVEL 3 -->
    <div id= "estructuraDelNivel3"></div>

    <br><p><b>&nbsp;* [% "Campos obligatorios" | i18n %]</b></p>
    
    <center>
    <input  type="image" src="[% themelang %]/images/guardar.png" value="[% 'Guardar nivel 3' | i18n %]" title="[% 'Guardar nivel 1' | i18n %]"  
            onClick="guardarDocumentoN3()">
    </center>
</span>

</div> <!--END <div class="centro">-->

<!-- detalle del Nivel 3, segun Nivel 2 seleccionado -->
<div id="detalleDelNivel3" class="nivel3Footer"></div>

</div> <!--END <div class="todo">-->

[% INCLUDE "intranet-bottom.inc" %]

