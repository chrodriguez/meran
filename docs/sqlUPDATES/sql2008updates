---------------------------------------------------------------
--Se agrega preferencia de logueo de busquedas para OPAC y para INTRA
insert into systempreferences (variable,value,explanation) 
values ('logSearchOPAC','0','Habilita (1) o no (0) loguea busquedas en el OPAC');

 insert into systempreferences (variable,value,explanation) 
values ('logSearchINTRA','0','Habilita (1) o no (0) loguea busquedas en la INTRA');


--Se agrega la columna tipo que dira (INTRAu OPAC)
ALTER TABLE historialBusqueda ADD COLUMN tipo VARCHAR(10);


-- se agrega la columna itemnumber a sanctions para poder informar desde que registro se produjo la sancion
ALTER TABLE `sanctions` ADD COLUMN `itemnumber` INTEGER  AFTER `delaydays`;


--Se agrega la columna id, responsable y nota a historicCirculation para poder saber quien fue el usuario que realizo la operacion, identificar a la tupla para poder agregarle una nota si es necesario.

ALTER TABLE `historicCirculation` ADD `responsable` VARCHAR( 20 ) NOT NULL AFTER `borrowernumber` ;
ALTER TABLE `historicCirculation` ADD `id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY FIRST ;
ALTER TABLE `historicCirculation` ADD `nota` VARCHAR( 50 ) NULL AFTER `date` ;
ALTER TABLE `historicCirculation` ADD `issuetype` CHAR( 2 );


--Se agraga la variable libreDeuda al las preferencias del sistema. Por defecto esta seteada para no permitir la impresion cuando el usuario tiene prestamos vencidos.

INSERT INTO `systempreferences` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES (
'libreDeuda', '00100', 'variable que limita la impresion del documento de libre deuda', NULL , NULL
);

-- Preferencias para mail de recordatorio de prestamo a vencer

INSERT INTO systempreferences (value,variable) VALUES ('0','reminderMail');

insert into  systempreferences (value,explanation,variable) VALUES ('Sr./Sra. FIRSTNAME SURNAME : \r\n\r\nSe le recuerda que el día VENCIMIENTO debe reintegrar el ejemplar que posee del libro  \r\nTITLE:UNITITLE - AUTHOR (EDICION) \r\na la BRANCH.\r\n\r\nMuchas gracias\r\n','Mensaje del mail de recordatorio de prestamo a vencer', 'reminderMessage');

insert into  systempreferences   (value,explanation,variable) VALUES ('Recordatorio de vencimiento de préstamos','Subject del mail de recodatorio de prestamo a vencer','reminderSubject');

--Se agrega campo 'enabled' en la tabla issuetypes para habilitar/deshabilitar tipos de prestamos 
--por ej: prestamos de verano para V2 y V3

ALTER TABLE issuetypes ADD COLUMN enabled tinyint default 1;


--La fecha de inicio y fin de las sanciones puede ser nulas por las sanciones que son pendientes

ALTER TABLE `sanctions` CHANGE `startdate` `startdate` DATE NULL DEFAULT '0000-00-00';
ALTER TABLE `sanctions` CHANGE `enddate` `enddate` DATE NULL DEFAULT '0000-00-00';

--QUIEN ROMPIO LOS PRESTAMOS ESPECIALES??????????????????----------

 insert into systempreferences (variable,value,explanation) values ('beginESissue','60','Cantidad de minutos antes del cierre de la biblioteca que se puede realizar un prestamo ESPECIAL.');

  insert into systempreferences (variable,value,explanation) values ('endESissue','60','Cantidad de minutos luego de la apertura de la biblioteca  en que se puede devolver un prestamo ESPECIAL.');



--Para saber si se puede o no seleccionar las bibliotecas

insert into systempreferences (variable,value,explanation) values ('selectHomeBranch','1','1 para poder seleccionar otra biblioteca, 0 para que la biblioteca sea la de defecto');


--Se crea una nueva tabla para loguear las sanciones

CREATE TABLE `historicSanctions` (
  `id` int(11) NOT NULL auto_increment,
  `type` varchar(15) NOT NULL default '',
  `borrowernumber` int(11) NOT NULL default '0',
  `responsable` varchar(20) NOT NULL,
  `timestamp` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  `date` date NOT NULL default '0000-00-00',
  `end_date` date default NULL,
  `sanctiontypecode` int(11) NOT NULL default '0',
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;


--  Curso de usuarios

ALTER TABLE `borrowers` ADD COLUMN `usercourse` date  DEFAULT NULL AFTER 'changepassword';

insert into systempreferences (variable,value,explanation)  values ('usercourse' ,'0','habilita o no que el curso de usuario sea necesario para utilizar el opac. ');


