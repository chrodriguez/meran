[% INCLUDE "intranet-top.inc" %]
<script src="/includes/jquery/jquery-highlight.js"></script>
<script language="javascript" type="text/javascript">
var busqueda_armed,incial_armed;
var flag_armed = false;

function consultar(filtro){
    
    busqueda = jQuery.trim($('#persona').val());
    inicial = '0';
    if (filtro){
        inicial = filtro;
        busqueda = jQuery.trim(filtro);
        $('#persona').val("filtro: "+filtro);
    }
    else
       {
        if (busqueda.substr(8,5).toUpperCase() == 'TODOS'){
                busqueda = busqueda.substr(8,5);
                $('#persona').val(busqueda);
                consultar(busqueda);
        }
        else
           {
            if (busqueda.substr(0,6).toUpperCase() == 'FILTRO'){
                busqueda = busqueda.substr(8,1);
                $('#persona').val(busqueda);
                consultar(busqueda);
            }
           }

    }
    if(busqueda.length > 0){
        busqueda_armed = busqueda;
        inicial_armed = inicial;
        flag_armed = true;
		buscarUsuariosPotenciales();
    }
    else{
        alert(INGRESE_UN_DATO);
        $('#persona').focus();
    }

}

function habilitar(){
	var checks=$("#result input[@type='checkbox']:checked");
	var array=checks.get();
	var theStatus="";
	var personNumbers=new Array();
	var cant=checks.length;
	var accion=$("#accion").val();
	if (cant>0){
		theStatus= UD_ESTA_A_PUNTO + accion + A_LOS_PROPIETARIOS; 
	
		for(i=0;i<checks.length;i++){
			theStatus=theStatus+ TARJETA_NRO + array[i].value+"\n";
			personNumbers[i]=array[i].name;
		}

		theStatus=theStatus + ESTA_SEGURO;
		if (cant>0){
			if (confirm (theStatus)){actualizarPersonas(cant,personNumbers);}
		}
	}
	else{ alert (NO_SE_SELECCIONO_NINGUN_USUARIO);}
}	

var objAH;
function ordenar(orden){
	objAH.sort(orden);
}

function changePage(ini){
	objAH.changePage(ini);
}

function actualizarPersonas(cant,arrayPersonNumbers){
	objAH=new AjaxHelper(updateInfoActualizar);
	objAH.url= "/cgi-bin/koha/usuarios/potenciales/usuariosPotencialesDB.pl";
	objAH.debug= true;
	objAH.cantidad= cant;
	objAH.tipoAccion= $("#accion").val();
	objAH.id_personas= arrayPersonNumbers;
	objAH.funcion= "changePage";
	objAH.sendToServer();
}

function updateInfoActualizar(responseText){

 	var Messages=JSONstring.toObject(responseText);
	setMessages(Messages);
//     objAH.cache = false;
	buscarUsuariosPotenciales();
}

function buscarUsuariosPotenciales(){
    objAH=new AjaxHelper(updateInfo);
    objAH.debug= true;
    objAH.url= "/cgi-bin/koha/usuarios/potenciales/buscarUsuarioResult.pl";
    objAH.funcion= "changePage";

    if (flag_armed){
        objAH.persona = busqueda_armed;
        objAH.inicial = inicial_armed;
    }else{   
        var busqueda = $("#persona").val();
	    if(busqueda != ""){
		    objAH.persona= busqueda;
	    }
	    else{
		    alert(INGRESE_UN_DATO);
            $("#persona").focus();
	    }
    }

	objAH.habilitados_filter = 0;
    if ($("#habilitados_filter").attr('checked'))  
        objAH.habilitados_filter = 1;

    objAH.sendToServer();
}

function updateInfo(responseText){
	$("#result").html(responseText);
	zebra("tablaResult");
    var idArray = [];
    var classes = [];
    idArray[0] = 'persona';
    classes[0] = 'nomCompleto';
    classes[1] = 'documento';
    busqueda = jQuery.trim($('#persona').val());
    if (busqueda.substr(0,6).toUpperCase() != 'FILTRO') //SI NO SE QUISO FILTRAR POR INICIAL, NO TENDRIA SENTIDO MARCARLO
      highlight(classes,idArray);
}

function Borrar(){
    $('#persona').val('');
}

function checkFilter(eventType){
    var str = $('#persona').val();
    
    if (eventType.toUpperCase() == 'FOCUS'){

        if (str.substr(0,6).toUpperCase() == 'FILTRO'){
            globalSearchTemp = $('#persona').val();
            Borrar();
        }
    }
    else
       {
        if (jQuery.trim($('#persona').val()) == "")
            $('#persona').val(globalSearchTemp);
       }
}


$(document).ready(function() {
	onEnter("persona",consultar);
});

</script>

<center>

<table width="100%"  border="0" cellpadding="0" cellspacing="0" align="center">
	<tr>
		<td class="titulos_interior" >
                        [% "B&uacute;squeda de Usuarios Potenciales" | i18n %]
                </td>
	</tr>
	<tr>
		<td class="lineagruesa"  align="left" colspan="3"></td>
	</tr>
</table>

<br>
<p id="msj" style="font-size:12pt; color:red"></p>

<table>
	<tr>
  		<td>
			<input id="persona" type=text name="persona" value="[% persona %]" onFocus="checkFilter('focus')" 
                onBlur="checkFilter('blur')">
		</td>
 		<td>
			<input id="buscar" type="image" onClick="buscarUsuariosPotenciales();" 
                               src="[% themelang %]/images/boton-buscar.png" border='0'>

			<input type="image" onClick="Borrar();" alt="Limpiar" 
                               src="[% themelang %]/images/borrar2.png" border="0" >

		</td>
	</tr>
		<tr>
		<td class="inputFontNormal" colspan=2>
			<p class="recuadroAyuda">
			 [% "Tipear el apellido, DNI o legajo del usuario. Presionar buscar." | i18n %]
			</p>
		</td>
	</tr>
</table>
<div id="filterBar" style="text-align:center">
        <a href="#tablaResult" onClick="consultar('A')"> A |</a>
        <a href="#tablaResult" onClick="consultar('B')"> B |</a>
        <a href="#tablaResult" onClick="consultar('C')"> C |</a>
        <a href="#tablaResult" onClick="consultar('D')"> D |</a>
        <a href="#tablaResult" onClick="consultar('E')"> E |</a>
        <a href="#tablaResult" onClick="consultar('F')"> F |</a>
        <a href="#tablaResult" onClick="consultar('G')"> G |</a>
        <a href="#tablaResult" onClick="consultar('H')"> H |</a>
        <a href="#tablaResult" onClick="consultar('I')"> I |</a>
        <a href="#tablaResult" onClick="consultar('j')"> J |</a>
        <a href="#tablaResult" onClick="consultar('K')"> K |</a>
        <a href="#tablaResult" onClick="consultar('L')"> L |</a>
        <a href="#tablaResult" onClick="consultar('M')"> M |</a>
        <a href="#tablaResult" onClick="consultar('N')"> N |</a>
        <a href="#tablaResult" onClick="consultar('O')"> O |</a>
        <a href="#tablaResult" onClick="consultar('P')"> P |</a>
        <a href="#tablaResult" onClick="consultar('Q')"> Q |</a>
        <a href="#tablaResult" onClick="consultar('R')"> R |</a>
        <a href="#tablaResult" onClick="consultar('S')"> S |</a>
        <a href="#tablaResult" onClick="consultar('T')"> T |</a>
        <a href="#tablaResult" onClick="consultar('U')"> U |</a>
        <a href="#tablaResult" onClick="consultar('V')"> V |</a>
        <a href="#tablaResult" onClick="consultar('W')"> W |</a>
        <a href="#tablaResult" onClick="consultar('X')"> X |</a>
        <a href="#tablaResult" onClick="consultar('Y')"> Y |</a>
        <a href="#tablaResult" onClick="consultar('Z')"> Z |</a>
        <a href="#tablaResult" onClick="consultar('TODOS')"> [% "TODOS" | i18n %] </a>
        
</div>

<div>
    <input type="checkbox" name="habilitados_filter" id="habilitados_filter"> S&oacute;lo habilitados 
</div>

<br>
<div id="result"></div>
</center>

[% INCLUDE "intranet-bottom.inc" %]

