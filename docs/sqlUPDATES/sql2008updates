---------------------------------------------------------------
--Se agrega preferencia de logueo de busquedas para OPAC y para INTRA
insert into systempreferences (variable,value,explanation) 
values ('logSearchOPAC','0','Habilita (1) o no (0) loguea busquedas en el OPAC');

 insert into systempreferences (variable,value,explanation) 
values ('logSearchINTRA','0','Habilita (1) o no (0) loguea busquedas en la INTRA');


--Se agrega la columna tipo que dira (INTRAu OPAC)
ALTER TABLE historialBusqueda ADD COLUMN tipo VARCHAR(10);


-- se agrega la columna itemnumber a sanctions para poder informar desde que registro se produjo la sancion
ALTER TABLE `sanctions` ADD COLUMN `itemnumber` INTEGER  AFTER `delaydays`;


--Se agrega la columna id, responsable y nota a historicCirculation para poder saber quien fue el usuario que realizo la operacion, identificar a la tupla para poder agregarle una nota si es necesario.

ALTER TABLE `historicCirculation` ADD `responsable` VARCHAR( 20 ) NOT NULL AFTER `borrowernumber` ;
ALTER TABLE `historicCirculation` ADD `id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY FIRST ;
ALTER TABLE `historicCirculation` ADD `nota` VARCHAR( 50 ) NULL AFTER `date` ;
ALTER TABLE `historicCirculation` ADD `issuetype` CHAR( 2 );


--Se agraga la variable libreDeuda al las preferencias del sistema. Por defecto esta seteada para no permitir la impresion cuando el usuario tiene prestamos vencidos.

INSERT INTO `systempreferences` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES (
'libreDeuda', '00100', 'variable que limita la impresion del documento de libre deuda', NULL , NULL
);

-- Preferencias para mail de recordatorio de prestamo a vencer

INSERT INTO systempreferences (value,variable) VALUES ('0','reminderMail');

insert into  systempreferences (value,explanation,variable) VALUES ('Sr./Sra. FIRSTNAME SURNAME : \r\n\r\nSe le recuerda que el d�a VENCIMIENTO debe reintegrar el ejemplar que posee del libro  \r\nTITLE:UNITITLE - AUTHOR (EDICION) \r\na la BRANCH.\r\n\r\nMuchas gracias\r\n','Mensaje del mail de recordatorio de prestamo a vencer', 'reminderMessage');

insert into  systempreferences   (value,explanation,variable) VALUES ('Recordatorio de vencimiento de pr�stamos','Subject del mail de recodatorio de prestamo a vencer','reminderSubject');

--Se agrega campo 'enabled' en la tabla issuetypes para habilitar/deshabilitar tipos de prestamos 
--por ej: prestamos de verano para V2 y V3

ALTER TABLE issuetypes ADD COLUMN enabled tinyint default 1;


--La fecha de inicio y fin de las sanciones puede ser nulas por las sanciones que son pendientes

ALTER TABLE `sanctions` CHANGE `startdate` `startdate` DATE NULL DEFAULT '0000-00-00';
ALTER TABLE `sanctions` CHANGE `enddate` `enddate` DATE NULL DEFAULT '0000-00-00';

--QUIEN ROMPIO LOS PRESTAMOS ESPECIALES??????????????????----------

 insert into systempreferences (variable,value,explanation) values ('beginESissue','60','Cantidad de minutos antes del cierre de la biblioteca que se puede realizar un prestamo ESPECIAL.');

  insert into systempreferences (variable,value,explanation) values ('endESissue','60','Cantidad de minutos luego de la apertura de la biblioteca  en que se puede devolver un prestamo ESPECIAL.');



--Para saber si se puede o no seleccionar las bibliotecas

insert into systempreferences (variable,value,explanation) values ('selectHomeBranch','1','1 para poder seleccionar otra biblioteca, 0 para que la biblioteca sea la de defecto');


--Se crea una nueva tabla para loguear las sanciones

CREATE TABLE `historicSanctions` (
  `id` int(11) NOT NULL auto_increment,
  `type` varchar(15) NOT NULL default '',
  `borrowernumber` int(11) NOT NULL default '0',
  `responsable` varchar(20) NOT NULL,
  `timestamp` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  `date` date NOT NULL default '0000-00-00',
  `end_date` date default NULL,
  `sanctiontypecode` int(11) NOT NULL default '0',
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;

-- este es el campo q se modifico, es para el mono
ALTER TABLE `historicSanctions` CHANGE `issuetype` `sanctiontypecode` INT( 11 ) NULL DEFAULT NULL 

--  Curso de usuarios

ALTER TABLE `borrowers` ADD COLUMN `usercourse` date  DEFAULT NULL AFTER 'changepassword';

insert into systempreferences (variable,value,explanation)  values ('usercourse' ,'0','habilita o no que el curso de usuario sea necesario para utilizar el opac. ');

--Branch por defecto
INSERT INTO `systempreferences` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES ('defaultbranch', 'DIF', 'Unidad de informacion por defecto', NULL , NULL);

-- Se agrega campo indice para guardar el indice del libro

ALTER TABLE `biblioitems` ADD `indice` TEXT NOT NULL AFTER `number` ;

ALTER TABLE `biblioitems` ADD FULLTEXT (`indice`);

-- Se agrega preferencia para mostrar o no el historico de reservas en el OPAC

INSERT INTO `systempreferences` ( `variable` , `value` , `explanation` , `options` , `type` )

VALUES ('showHistoricReserves', '1', 'Muestra (valor = 1) o no el historico de reservas en el OPAC', NULL , NULL);

-- el campo sanctiotypecode puede ser NULL si se hace una reservar y no se retirada y luego 
-- se sanciona al usuario

ALTER TABLE `historicSanctions` CHANGE `sanctiontypecode` `sanctiontypecode` INT( 11 ) NULL DEFAULT '0';


-- Se agrega una preferencia y se actualiza otra para el aviso de prestamos vencidos

update systempreferences set value='Sr./Sra.  FIRSTNAME SURNAME :\r\n\r\nMENSAJEVENCIDO\r\n\r\nBRANCH\r\n',explanation='Mensaje del mail' where variable='mailMessage';


Insert into systempreferences (variable,value,explanation) values ('mailMensajeVencido',' Debe un ejemplar de\r\n        TITLE:UNITITLE\r\n desde la fecha DATE.','Como se envia el vencimiento de un ejemplar por mail');


--se agrego la siguente tabla:

CREATE TABLE `keyword` (
`idkeyword` INT( 11 ) NOT NULL AUTO_INCREMENT PRIMARY KEY ,
`keyword` VARCHAR( 150 ) NOT NULL
) ENGINE = MYISAM ;


--se agrega tabla (N a N) entre keyword y biblioanalysis

CREATE TABLE `analyticalkeyword` (
`idkeyword` INT( 11 ) NOT NULL ,
`analyticalnumber` VARCHAR( 11 ) NOT NULL ,
PRIMARY KEY ( `idkeyword` , `analyticalnumber` )
) ENGINE = MYISAM ;


--se agregaron los siguientes campos a la tabla biblioanalysis

ALTER TABLE `biblioanalysis` ADD `resumen` TEXT NULL AFTER `classification` ,
ADD `url` VARCHAR( 100 ) NULL AFTER `resumen` ;

ALTER TABLE `biblioanalysis` ADD FULLTEXT (`resumen`);

-- Reservas desde la Intranet!!!

Insert into systempreferences (variable,value,explanation) values ('intranetGroupReserve','0','Indica que  si al realizar un prestamo desde la intranet y no se encuentra ningun ejemplar libre, se realiza o no (1 o 0) una reserva sobre el grupo desde la intranet.');
--


--Se agrego una nueva variable para parametrizar la vista de las paginas que muestra el nuevo paginador.

INSERT INTO systempreferences (variable,value,explanation,type,options) VALUES ('paginas','10','Cantidad de paginas que va a  mostrar el paginador.','text','');


--Se modifca el campo constrainttype por estado (P='Prestado', E='Reserva Ejemplar', G='Reserva de Grupo')

ALTER TABLE `reserves` CHANGE `constrainttype` `estado` CHAR( 1 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL 

--Se eliminan los siguiente campos de la tabla reservas para V3

ALTER TABLE `reserves` DROP `biblioitemnumber` ,
DROP `priority` ,
DROP `found` ,
DROP `itemnumber` ;

--Se agregan los siguientes campos en reservas para V3

ALTER TABLE `reserves` ADD `id2` INT( 11 ) NOT NULL FIRST ,
ADD `id3` INT( 11 ) NULL AFTER `id2` ;


--Se modifico el siguiente campo en la tabla issues para V3

ALTER TABLE `issues` CHANGE `itemnumber` `id3` INT( 11 ) NOT NULL DEFAULT '0';

--Se modifco los siguientes campos en historicCirculation

ALTER TABLE `historicCirculation` CHANGE `biblionumber` `id1` INT( 11 ) NOT NULL DEFAULT '0',
CHANGE `biblioitemnumber` `id2` INT( 11 ) NOT NULL DEFAULT '0',
CHANGE `itemnumber` `id3` INT( 11 ) NULL DEFAULT NULL 

--Se saco el indice unico que habia quedado al cambiar el nombre del campo biblioitemnumber por id2
ALTER TABLE `reserves` DROP INDEX `IdUnico` 

--Se agrego una fila en la tabla unavailable para la V3, porque es necesario para el componente que se crean dinamicamente, de disponibilidad.

INSERT INTO `unavailable` ( `code` , `description` )
VALUES (
'0', 'Disponible'
);


--Se modifico el campo itemnumber de la tabla sanctions

ALTER TABLE `sanctions` CHANGE `itemnumber` `id3` INT( 11 ) NULL DEFAULT NULL 
--Se modifco el siguiente campo

ALTER TABLE `shelfcontents` CHANGE `biblioitemnumber` `id2` INT( 11 ) NOT NULL DEFAULT '0'


*************SE MODIFICO EL PATH DE LOGEO DEL ARCHIVO /etc/koha/koha.conf A kohalogdir=/var/log/koha***************
SE TIENE QUE CREAR UN ARCHIVO CON NOMBRE debugErrorDBA.txt CON PERMISOS DE ESCRITURA PARA TODOS LOS USUARIOS. 



-- Se eliminaron las siguientes tablas

DROP TABLE `additionalauthors`, `aqbookfund`, `aqbooksellers`, `aqbudget`, `aqorderbreakdown`, `aqorderdelivery`, `aqorders`, `biblio`, `biblioitems`, `bibliosubject`, `bibliosubtitle`, `bibliothesaurus`, `borexp`, `branchtransfers`, `catalogueentry`, `categoryitem`, `currency`, `defaultbiblioitem`, `deletedbiblio`, `deletedbiblioitems`, `deleteditems`, `ethnicity`, `isbns`, `isomarc`, `items`, `itemsprices`, `printers`, `publisher`, `reserveconstraints`, `statistics`, `virtual_itemtypes`, `virtual_request`, `marc_subfield_table`;


--Se agrega preferencia para controlar la longitud minima de la password
insert into systempreferences (variable,value,explanation) 
values ('minPassLength','8','Longitud minima de la password');


-- TIPOS DE DOCUMENTOS
CREATE TABLE `tipo_documento` (
`idTipoDoc` INT NOT NULL AUTO_INCREMENT PRIMARY KEY ,
`nombre` VARCHAR( 50 ) NOT NULL ,
`descripcion` VARCHAR( 250 ) NOT NULL
) ENGINE = innodb CHARACTER SET latin1 COLLATE latin1_spanish_ci;
");

INSERT INTO `tipo_documento` ( `nombre` , `descripcion` ) 
VALUES ('DNI', 'DNI'), ('LC', 'LC'), ('LE', 'LE'), ('CI', 'CI'), ('PAS', 'PAS') ;



-- Se agregaron preferencias para validar el password, todas en 0 (cero)

INSERT INTO systempreferences(variable, value, explanation)
VALUES ("minPassAlpha",0,"Longitud Minina de Caracteres alfabétios");

##########################################################################

INSERT INTO systempreferences(variable, value, explanation)
VALUES ("minPassAlphaNum",0,"Longitud Minina de Caracteres alfanuméricos");

##########################################################################

INSERT INTO systempreferences(variable, value, explanation)
VALUES ("minPassLower",0,"Longitud Minina de Caracteres alfabétios minúsculos");

##########################################################################

INSERT INTO systempreferences(variable, value, explanation)
VALUES ("minPassNUmeric",0,"Longitud Minina de Caracteres numericos");

##########################################################################

INSERT INTO systempreferences(variable, value, explanation)
VALUES ("minPassSymbol",0,"Longitud Minina de Caracteres alfabétios");

##########################################################################

INSERT INTO systempreferences(variable, value, explanation)
VALUES ("minPassUpper",0,"Longitud Minina de Caracteres alfabétios");

##########################################################################

INSERT INTO systempreferences(variable, value, explanation)
VALUE ("maxPassWhite",0,"Longitud Maxima de Espacios permitidos");

##########################################################################

(((((((((( ACTUALIZAR LOS COMENTARIOS EN LA TABLA :S)





















