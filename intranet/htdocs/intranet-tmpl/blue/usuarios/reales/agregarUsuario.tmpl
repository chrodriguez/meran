[% IF addBorrower == 1 %]
    [% INCLUDE "intranet-top.inc" %] 
[% END %]

<script src="/intranet-tmpl/blue/includes/usuarios/usuariosReales.js"></script>
<script src="/intranet-tmpl/blue/includes/jquery/jquery.bgiframe.min.js"></script>
<script src="/intranet-tmpl/blue/includes/jquery/jquery.dimensions.js"></script>
<script src="/intranet-tmpl/blue/includes/jquery/jquery.autocomplete.js"></script>
<script src="/intranet-tmpl/blue/includes/jquery/jquery.validate.js"></script>

<link href="/intranet-tmpl/blue/includes/jquery/jquery.autocomplete.css" type="text/css" rel="stylesheet">

<script src="/intranet-tmpl/blue/includes/jquery/datetimepicker/ui.datepicker.js"></script>
<link href="/intranet-tmpl/blue/includes/jquery/datetimepicker/flora.datepicker.css" type="text/css" rel="stylesheet">

<script type="text/javascript">
//    apply inline-box only for mozilla
if( jQuery.browser.mozilla ) {
   // do when DOM is ready
   $( function() {
      // search form, hide it, search labels to modify, filter classes nocmx and error
      $( '#userDataForm' ).hide().find( 'p>label:not(.nocmx):not(.error)' ).each( function() {
         var $this = $(this);
         var labelContent = $this.html();
         var labelWidth = document.defaultView.getComputedStyle( this, '' ).getPropertyValue( 'width' );
         // create block element with width of label
         var labelSpan = $("<span>")
            .css("display", "block")
            .width(labelWidth)
            .html(labelContent);
         // change display to mozilla specific inline-box
         $this.css("display", "-moz-inline-box")
            // remove children
            .empty()
            // add span element
            .append(labelSpan);
      // show form again
      }).end().show();
   });
};
      $.validator.setDefaults({
         submitHandler: function() { agregarUsuario(); }
      });
      
      $().ready(function() {
         // validate the comment form when it is submitted
//          $("#userDataForm").validate();
         
         // validate signup form on keyup and submit
         $("#userDataForm").validate({
            rules: {
               apellido: "required",
               nombre: "required",
               legajo: "required",
               nro_socio: "required",
               sexo: "required",
               calle: "required",
               ciudad: "required",
               nacimiento: "required",
               telefono: "required",
               telefono_laboral: "required",
               alt_calle: "required",
               codigo_postal: "required",

               nro_documento: {
                  required: true,
                  minlength: 8,
                  maxlength: 8
               },
               email: {
                  required: true,
                  email: true
               },
            },
            messages: {
               apellido: "Por favor, ingrese su apellido",
               nombre: "Por favor, ingrese su/s nombre/s",
               legajo: "El legajo es obligatorio",
               nro_socio: "La tarjeta de id. es obligatoria",
               sexo: "El sexo es obligatorio",
               calle: "La calle en donde vive es obligatoria",
               ciudad: "La ciudad en donde vive es obligatoria",
               nacimiento: "La fecha de nacimiento es obligatoria",
               telefono: "El tel&eacute;fono es obligatorio",
               codigo_postal: "El c&oacute;digo postal debe ser ingresado",
               nro_documento: {
                  required: "Por favor, ingrese su nro. de documento",
                  minlength: "La longitud del documento debe ser de 8 d&iacute;gitos (ha ingresado menos)",
                  maxlength: "La longitud del documento debe ser de 8 d&iacute;gitos (ha ingersado m&aacute;s)",
               },
               email: "Ingrese una direcci√≥n de email v&aacute;lida",
            }
         });
      });

</script>

<script language="javascript" type="text/javascript">

// FIXME FALTA VALIDAD EN EL CLIENTE

function getId(IdObj, id){
    //guardo en hidden el id
    $('#'+IdObj).val(id);
}
    
function CrearAutocomplete(Id, IdHidden){
    $("#"+Id).search();
    // q= valor de campoHelp
    $("#"+Id).autocomplete('/cgi-bin/koha/autocompletables/searchcity.pl',{
        formatItem: function(row){
            return row[1];
        },
        minChars:1,
            matchSubset:1,
            matchContains:1,
        maxItemsToShow:10,
            cacheLength:10,
            selectOnly:1,
    });//end autocomplete
    $("#"+Id).result(function(event, data, formatted) {
        $("#"+Id).val(data[1]);
        getId(IdHidden, data[0])
    });
}
</script>
<style type="text/css">
      #userDataForm label { width: 250px; }
      #userDataForm label.error, #userDataForm input.submit { margin-left: 253px;
                                                              color:red;
                                                              font-weight:bold; }
      #userDataForm label.error {
         margin-left: 10px;
         width: auto;
         display: block;;
         color:red;
         font:bold; 
      }
</style>

<script>
$(document).ready(function() {
     $("#userDataForm").validate();
    CrearAutocomplete('ciudad', 'id_ciudad');
    CrearAutocomplete('alt_ciudad', 'id_alt_ciudad');
    $('#nacimiento').datepicker({ dateFormat: 'dd/mm/yy' });
    
});

</script>

[% IF addBorrower %]
    <!-- Mensajes de Informacion al Usuario -->
    <div class="tableMsgUser">
        <font class="fontMsgUser"><b>
        <div id="mensajes"></div>
        </b></font>
    </div>
[% END %]
<center>
<table width="100%"  border="0" cellpadding="0" cellspacing="0" align="center">
    <tr>
        <td class="pagetitle" >
            [% IF addBorrower %]
                [% "Agregar usuario real" | i18n %]
            [% ELSE  %]
                [% "Usuarios Reales - Modificar Datos" | i18n %]
            [% END %]
        </td>
    </tr>
    <tr>
        <td class="lineagruesa"  align="left" colspan="3"></td>
    </tr>
</table>

<br>

<!--<form action="/cgi-bin/koha/usuarios/newmember.pl" method=post  name="form1" AUTOCOMPLETE='off'>-->
<form method=post  name="userDataForm" id="userDataForm" AUTOCOMPLETE='off'>

<table border=0  width="100%" class="tablaresultado" align="right">
    <tr valign=top width="100%">
        
        <td  width="50%" ALIGN=RIGHT class="required">
         [% "Tarjeta de identificaci&oacute;n" | i18n %] * 
        <input id="nro_socio" type=text class="required" name=nro_socio size=10 value="[% socio.getNro_socio %]"><br>
        </td>
    </tr>

</table>
    <br>
    <br>
    <br>
<table width="100%"  cellpadding='0' cellspacing='0'>
    <tr valign=middle class="tablaresultadoTitle">
        <td width="1%" align="left" valign="top">
            <img src="[% themelang %]/images/izquierda.png">
        </td>

        <td width="35%" >[% "DATOS PERSONALES DEL USUARIO" | i18n %]</td>
        <td   width="65%" ALIGN=RIGHT>*
            <input type="radio" name="sexo" value="F" [% IF socio.persona.getSexo == "F" %] class="required" checked="checked" F [% END %]> F
            <input type="radio" name="sexo" value="M" [% IF socio.persona.getSexo == "M" %] class="required" checked="checked" M [% END %]> M 
            &nbsp; &nbsp;  [% "Fecha de nacimiento" | i18n %] ([% socio.persona.getNacimiento %])
            <input class="required" type=text id="nacimiento" name="nacimiento" size=10 value="[% socio.persona.getNacimiento %]">
        </td>

        <td width="1%" valign="top" align="right">
            <img src="[% themelang %]/images/derecha.png">
        </td>
    </tr>
</table>

<table width="100%">
    <tr>
         <td  class="required" align="left">
         <b>[% "Categor&iacute;a del usuario" | i18n %] *</b>
         <br>
                [% comboDeCategorias %]
         </td>
         <td width="5%">&nbsp;</td>
    </tr>
    <tr>
        <td width="35%" class="inputFontNormal" align="left">
                <b> [% "Apellido" | i18n %] *</b><br>
                <input id="apellido" name="apellido" class="required" type=text size=50 value="[% socio.persona.getApellido %]">
        </td>
        <td width="35%" class="inputFontNormal" align="left">
            <b> [% "Nombres" | i18n %] *</b><br>
                    <input  id="nombre" name="nombre" class="required" type=text size=50 value="[% socio.persona.getNombre %]">
        </td>
        <td width="5%">&nbsp;</td>
    </tr>
    <tr>
        <td width="35%" class="inputFontNormal" align="left">
            <b>[% "Documento" | i18n %] ([% "solo digitos" | i18n %]) *</b><br>
                    [% combo_tipo_documento %]
            <input id="nro_documento" name="nro_documento" class="required" minlength="8" maxlength="12" type=text size=41 value="[% socio.persona.getNro_documento %]">
        </td>
        <td width="35%" class="inputFontNormal" align="left">
            <b>[% "Legajo" | i18n %]</b><br>
                <input  class="required" type=text name="legajo" id="legajo" size=50 value="[% socio.persona.getLegajo %]">
        </td>
        <td width="5%">&nbsp;</td>
    </tr>
</table>

    <br>
<table width=100%>
    <tr valign=top >
        <td   width="60%" class="inputFontNormal">
            <input  class="required" type="checkbox" id="changepassword" [% socio.getChange_password %] checked>
            &nbsp;[% "Forzar al usuario a cambiar su contrase&ntilde;a periodicamente" | i18n %]
        </td>
        <td>
            [% IF ethcatpopup %]
                <select class="required" id="ethnicity" size=1>
                    [% FOREACH project IN ethnicityloop  %]
                        <option value=[% project.value %][% project.selected %]>[% project.label %]
                    [% END %]
                </select>
            [% END %]
        </td>
    </tr>
    <tr>
        <td>&nbsp;</td>
    </tr>

    [% IF course %]
        <tr>
            <td   width="60%" class="inputFontNormal">
                <input  class="required" type="checkbox" id="usercourse" 
                    [% usercourse %] 
                        checked 
                >
                &nbsp;[% "Realiz&oacute; el curso de usuario?" | i18n %] 
            </td>
            <td> 
        </tr>
        <tr>
            <td>&nbsp;</td>
        </tr>
    [% END %]

    <tr>
        <td class="inputFontNormal">
             <b>
                [% "Incorporaci&oacute;n a Unidad de Informaci&oacute;n" | i18n %]
                         </b>&nbsp;
                [% comboDeUI %]
        </td>   
    </tr>
</table>
    <br>
    <br>
<table width="100%"  cellpadding='0' cellspacing='0'>
    <tr valign=middle colspan=6 width="100%" class="tablaresultadoTitle">
        <td width="1%" align="left" valign="top">
            <img src="[% themelang %]/images/izquierda.png">
        </td>
        <td COLSPAN=6 width="100%">[% "DIRECCI&Oacute;N DEL USUARIO" | i18n %]</td>
        <td width="1%" valign="top" align="right">
            <img src="[% themelang %]/images/derecha.png">
        </td>
    </tr>
        <tr valign=middle>
        <td height=25 class="[% clase %] ">&nbsp;</td>
        <td>&nbsp;</td> 
        <td height=25 class="[% clase %]" >&nbsp; </td>
    </tr>

        <tr align="center" valign=middle>
        <td height=25 class="[% clase %]">&nbsp;</td>
            <td width="40%" class="required" align="left" valign="top">
            <b>[% "Direcci&oacute;n" | i18n %] *</b><br>
            <input class="required" type=text id="calle" name="calle" size=50 value="[% socio.persona.getCalle %]">
        </td>
        <td width="40%" class="required" align="left" valign="top">
            <b>[% "C&oacute;digo Postal" | i18n %]</b><br>
            <input class="required" type="text" name="codigo_postal"  id="codigo_postal" size=50 value="[% codigo_postal %]">
        </td>
    </tr>
    <tr>
        <td height=25 class="[% clase %]">&nbsp;</td>
            <td width="40%" class="inputFontNormal" align="left" valign="top">
            <b>[% "Tel&eacute;fono particular" | i18n %]</b><br>
                <input class="required" type=text id="telefono" name="telefono" size=50 value="[% socio.persona.getTelefono %]">
        </td>
        <td width="40%" class="required" align="left" valign="top">
            <b>[% "Ciudad" | i18n %] *</b><br>
            <input class="required" type=text id="ciudad" name="ciudad" value="[% socio.persona.ciudad_ref.getNombre %]" size='50' >
            <input type="hidden" id="id_ciudad" name="id_ciudad" value="[% socio.persona.ciudad_ref.LOCALIDAD %]">
        </td>
    </tr>
    <tr>
        <td height=25 class="[% clase %]>&nbsp;</td>
            <td width="15%">&nbsp;</td>
            <td width="40%" class="inputFontNormal" align="left" valign="top">
            <b>[% "Tel&eacute;fono del trabajo" | i18n %]</b><br>
                <input class="required" type=text id="telefono_laboral" name="telefono_laboral" size=50 value="[% socio.persona.getTelefono_laboral %]">
        </td>
    </tr>
    <tr>
            <td height=25 class="[% clase %]">&nbsp;</td>
            <td width="40%" class="required" align="left" valign="top">
            <b>[% "Direcci&oacute;n de origen" | i18n %]</b><br>
                <input  class="required" type=text id="alt_calle" name="alt_calle" size=50 value="[% socio.persona.getAlt_calle %]">
        </td>
            <td width="40%" class="inputFontNormal" align="left" valign="top">
            <b>[% "Ciudad de origen" | i18n %]</b><br>
            <input  class="InputFontNormal" type=text id="alt_ciudad" name="alt_ciudad" value="[% socio.persona.getAlt_ciudad %]" size='50'>
            <input class="InputFontNormal" type=hidden id="id_alt_ciudad" value="[% socio.persona.ciudad_ref.LOCALIDAD %]"> 
        </td>
        </tr>
    <tr>
            <td height=25 class="[% clase %]">&nbsp;</td>
            <td width="15%">&nbsp;</td>
            <td width="40%" class="inputFontNormal" align="left" valign="top">
                <b>E-Mail</b><br>
                <input class="required email" type=text id="email" name="email" size=50 value="[% socio.persona.getEmail %]">
        </td>
            <td width="40%" class="required" align="left" valign="top">&nbsp;</td>
        </tr>
    <tr>
        <td colspan="4">&nbsp;</td>
    </tr>

    <br>

<br>
<br>
<table width=100%>
    <tr>
        <td width="50%" align="right">
                    <input type=hidden name=type value="[% type %]">

        [% IF addBorrower %]
            <a onClick="$('#userDataForm').submit()" >
                    <img alt="Guardar" src="[% themelang %]/images/guardar.png" border="0"></a>
        [% ELSE  %]
            <a onClick="guardarModificacioUsuario()" >
                    <img alt="Guardar Modificacion" src="[% themelang %]/images/guardar.png" border="0"></a>
        [% END %]
    
            
                </td>
        <td  width="25%" align="left"> 
            <a href="#" onClick="form1.reset()" >
            <img name="clear" id="clear" alt="Limpiar" src="[% themelang %]/images/borrar2.png" border="0">
            </a>
        </td>
        
        <td  align="left" class="inputFontNormal">
            <b>(*) [% "Obligatorio " | i18n %]</b>
        </td>
        
    
    </tr>
</table>
</form>

[% IF addBorrower %]
    [% INCLUDE "intranet-bottom.inc" %]
[% END %]
            
