[% INCLUDE 'intranet-top.inc' %]

[% INCLUDE  'AutocompleteHelper.inc'  %]

[% USE HTML %]

<link rel="stylesheet" type="text/css" href="[% temas %]/[% tema %]/includes/css/fancybox/jquery.fancybox.css">
<script src="/includes/jquery/jquery.charCount.js"></script>
<script type="text/javascript" src="/includes/jquery/jquery.wysiwyg.js"></script>
<script type="text/javascript" src="/includes/jquery/jquery.livetwitter.js"></script>
<link rel="stylesheet" href="/includes/css/wysiwyg.css" type="text/css" media="screen"/>

<script type="text/javascript">
var jobID = 0;

	function test(){
		    objAH                   = new AjaxHelper(updateTest);
		    objAH.url               = URL_PREFIX+'/start_job.pl';
		    objAH.debug             = true;
		    objAH.showOverlay       = false;
		    objAH.accion            = "START_DEMO"; 
		    objAH.sendToServer();

	}

	function updateTest(responseText){
		jobID = responseText;
		checkProgress();
	}
	
		
</script>


<script type="text/javascript">

	$(document).ready(function() {
		CrearAutocompleteCatalogo({ 
		    IdInput: 'catalogo_search', 
		    IdInputHidden: 'catalogo_search_hidden', 
		    //callBackFunction: updateAutocompleteBarcodes
		});

        
        $('.fancy_link').fancybox({});

        mostrarNovedades();
        mensajesContacto();

        mensajes_interval_id = setInterval(mensajesContacto,10000);
        $("#button_twitter").hover(twitter_hover, twitter_normal);
 
        $("#button_twitter").click(twitter_click);
        
        [% IF twitter_username_to_search %]
	        $('#tweets').liveTwitter('[% twitter_username_to_search %]', {limit: 5, imageSize: 32}, function(){
	            $('#tweets .loading').remove();
	        });
        [% END %]
        
      });
  

    function mostrarNovedades(){
        var objAH_temp               = new AjaxHelper(updateActualizarTabla);
        objAH_temp.debug         = false;
        objAH_temp.showStatusIn  = '';
        objAH_temp.url           = URL_PREFIX+'/novedadesIntra.pl';
        objAH_temp.tipoAccion    = "MOSTRAR_NOVEDADES";
        objAH_temp.sendToServer();
    }

    function mensajesContacto(){
        var objAH_temp               = new AjaxHelper(updateMensajesContacto);
        objAH_temp.debug         = false;
        this.showState      = false;
        objAH_temp.url           = URL_PREFIX+'/mensajes_contacto.pl';
        objAH_temp.sendToServer();
    }

    function updateMensajesContacto(responseText){
    	$('#mensajes_contacto').html(responseText);
    }
    
    function updateActualizarTabla(responseText){
        $("#resultNovedades").html(responseText);
        $('.fancy_link').fancybox({
//                         onStart:function(){
//                               $('#state').css('display','');
//                         },
                        onComplete:function(){
                              $('#state').css('display','none');     
                        }
        });
    }

    function twitter_hover(){
        $("#button_twitter").attr("src","[% temas %]/[% tema %]/imagenes/botones/button_twitter_hover.png");
    }
  
    function twitter_normal(){
        $("#button_twitter").attr("src","[% temas %]/[% tema %]/imagenes/botones/button_twitter_normal.png");
    }

    function twitter_click(){
        $("#button_twitter").attr("src","[% temas %]/[% tema %]/imagenes/botones/button_twitter_click.png");
    }
    
    function responder(){
        $("#respuesta").wysiwyg();
        $(".responder").show(); 
        $(".wysiwyg").css('width','388px');   
        $("#fancybox-wrap").css('top','25px');
        $("#respuestaIFrame").css('width','388px');
        $("#responder").attr('onclick', ' '); 
    }

</script>
<h1>[% 'Principal' | i18n %] <small>[% 'Accesos frecuentes, novedades, mensajes' | i18n %]</small></h1>
<div class="well span4 " style="padding: 8px 0;">
        <ul class="nav nav-list">
          <li><a href="#"><i class="icon-home"></i>[% 'Accesos frecuentes' | i18n %]</a></li>
          <li>
                    [% PERL %]
                       print C4::AR::Filtros::link_to( text =>     "[% 'Mis datos' | i18n %]",
                                                   url=>"[% url_prefix %]/usuarios/reales/datosUsuario.pl", 
                                                   title =>    "[% 'Mis datos' | i18n %]",
                                                   params =>   ["nro_socio=[% nro_socio %]"],
                                                   icon => "icon-pencil",
                                                   tooltip => "['Ver y/o modificar sus datos' | i18n ]"
                           );
                   [% END %]
          </li>
          <li><a href="#"><i class="i"></i> Misc</a></li>
        </ul>
    </div>        


<div id="resultNovedades"></div>

<div id="mensajes_contacto"></div>

[% IF twitter_enabled %]

<div id="twitter_container" class="clear">
    [% IF twitter_username_to_search %]
	   <div id="tweets" class="tweets"><div class="loading">[% 'Cargando tweets...' | i18n %]</div></div>
	   <br />
    [% END %]
    <a class="fancy_link" href="[% url_prefix %]/admin/publicar_twitter.pl?token=[% token %]" > 
      <img id="button_twitter" src="[% temas %]/[% tema %]/imagenes/botones/button_twitter_normal.png" alt="Twitter"/>
    </a>
</div>
[% END %]

[% INCLUDE 'partials/_percent_bar.inc' %]


[% INCLUDE 'intranet-bottom.inc' %]
