
-- No se usa esta tabla
drop table users;

-- Se renombro la tabla

RENAME TABLE usr_socios  TO usr_socio;

--Se deja el id_persona en usr_socio
ALTER TABLE `usr_persona`  DROP `id_socio`;

--se modifico el campo
ALTER TABLE `usr_persona` CHANGE `vesion_documento` `version_documento` CHAR( 1 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL DEFAULT 'P' ;

--se modificaron los campos


ALTER TABLE `usr_socio` CHANGE `lastlogin` `last_login` DATETIME NULL DEFAULT NULL ,
CHANGE `lastchangepassword` `last_change_password` DATE NULL DEFAULT NULL ,
CHANGE `changepassword` `change_password` TINYINT( 1 ) NOT NULL DEFAULT '0';

ALTER TABLE `usr_persona` ADD `activo` tinyint( 1 ) unsigned NOT NULL default '1';

ALTER TABLE `usr_estado` ADD `id_estado` INT( 11 ) NOT NULL AUTO_INCREMENT PRIMARY KEY FIRST ;
ALTER TABLE `usr_estado` ADD UNIQUE (`id_persona` ,`fuente`);


--RENAMES si no lo hacen no anda nada!!!--

RENAME TABLE userflags TO usr_permiso;
RENAME TABLE sessions TO sist_sesion;
RENAME TABLE systempreferences TO pref_preferencia_sistema;
--


NO RENOMBRE LA TABLA CATEGORIES PARA NO ROMPER TODO, SE EXPORTO LA INFO Y SE MODIFICO EL NOMBRE DE LA TABLA
HAY 2 TABLAS AHORA, MAS ADELANTE SE ELIMINA CATEGORIES

CREATE TABLE `usr_ref_categoria_socio` (
  `categorycode` char(2) NOT NULL default '',
  `description` text,
  `enrolmentperiod` smallint(6) default NULL,
  `upperagelimit` smallint(6) default NULL,
  `dateofbirthrequired` tinyint(1) default NULL,
  `finetype` varchar(30) default NULL,
  `bulk` tinyint(1) default NULL,
  `enrolmentfee` decimal(28,6) default NULL,
  `overduenoticerequired` tinyint(1) default NULL,
  `issuelimit` smallint(6) default NULL,
  `reservefee` decimal(28,6) default NULL,
  `borrowingdays` smallint(30) NOT NULL default '14',
  UNIQUE KEY `categorycode` (`categorycode`)
) ENGINE=innodb DEFAULT CHARSET=latin1;

-- 
-- Volcar la base de datos para la tabla `categories`
-- 

INSERT INTO `usr_ref_categoria_socio` (`categorycode`, `description`, `enrolmentperiod`, `upperagelimit`, `dateofbirthrequired`, `finetype`, `bulk`, `enrolmentfee`, `overduenoticerequired`, `issuelimit`, `reservefee`, `borrowingdays`) VALUES 
('ES', 'Estudiante', 0, 55, 18, NULL, NULL, 0.000000, 0, 0, 0.000000, 14),
('IN', 'Investigador', 15, 100, 0, NULL, NULL, 0.000000, 0, 8, 0.000000, 14),
('DO', 'Docente', 10, 80, 0, NULL, NULL, 0.000000, 1, 5, 0.000000, 14),
('ND', 'No Docente', 10, 0, 0, NULL, NULL, 0.000000, 1, 3, 0.000000, 14),
('EG', 'Egresado', 10, 0, 0, NULL, NULL, 0.000000, 1, 3, 0.000000, 14),
('PG', 'Postgrado', NULL, 90, NULL, NULL, NULL, NULL, 1, 3, NULL, 14);

ALTER TABLE `usr_ref_categoria_socio` ADD PRIMARY KEY ( `categorycode` ) ;

ALTER TABLE usr_socio ADD FOREIGN KEY(id_persona) REFERENCES usr_persona(id_persona);



-- LOS BRANCHES


-- 
-- Estructura de tabla para la tabla `pref_unidad_informacion`
-- 

CREATE TABLE `pref_unidad_informacion` (
  `id_ui` varchar(4) NOT NULL,
  `nombre` varchar(255) NOT NULL,
  `direccion` varchar(255) default NULL,
  `alt_direccion` varchar(255) default NULL,
  `telefono` varchar(255) default NULL,
  `fax` varchar(255) default NULL,
  `email` varchar(255) default NULL,
  PRIMARY KEY  (`id_ui`)
) ENGINE=Innodb DEFAULT CHARSET=latin1;

-- 
-- Volcar la base de datos para la tabla `pref_unidad_informacion`
-- 

INSERT INTO `pref_unidad_informacion` (`id_ui`, `nombre`, `direccion`, `alt_direccion`, `telefono`, `fax`, `email`) VALUES 
('DEO', 'Facultad de Ciencias Económicas', '6 entre 47 y 48. 1° subusuelo', '0221-423-6771/6769', '', 'biblio@econo.unlp.edu.ar', NULL),
('DIF', 'Facultad de Informática', '115 esquina 50. 1° subusuelo', '', '', 'biblioteca@info.unlp.edu.ar', NULL),
('CD', 'Centro de Documentación', '7 Nº 445', '', '', '', NULL);


-- NUEVAS PREFERENCIAS


INSERT  INTO  `pref_preferencia_sistema` (  `variable` ,  `value` ,  `explanation` ,  `options` ,  `type`  ) 
VALUES ( 'autoActivarPersona',  '0',  'Activa por defecto un alta de una persona',  NULL ,  NULL );




ALTER TABLE `pref_unidad_informacion` ADD PRIMARY KEY ( `id_ui` );


-- Se creo una nueva preferencia, el 'defaultBranch' se conserva para que no se rompa nada, despues se borra

INSERT INTO `pref_preferencia_sistema` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES (
'defaultUI', 'DEO', 'Unidad de informacion por defecto', NULL , NULL
); 



INSERT INTO `pref_preferencia_sistema` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES (
'defaultTipoDoc', 'DNI', 'Tipo de Documento por defecto', NULL , NULL
); 


INSERT INTO `pref_preferencia_sistema` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES (
'defaultCategoriaSocio', 'ES', 'Categoria de Socio por defecto', NULL , NULL
); 

INSERT INTO `pref_preferencia_sistema` ( `variable` , `value` , `explanation` , `options` , `type` )
VALUES (
'defaultDisponibilidad', 'ES', 'Disponibilidad por defecto', NULL , NULL
); 



CREATE TABLE `ref_disponibilidad` (
  `codigo` tinyint(5) NOT NULL default '0',
  `nombre` varchar(255) NOT NULL default '',
  PRIMARY KEY  (`codigo`),
  UNIQUE KEY `nombre` (`nombre`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

-- 
-- Volcar la base de datos para la tabla `ref_disponibilidad`
-- 

INSERT INTO `ref_disponibilidad` (`codigo`, `nombre`) VALUES 
(1, 'Perdido'),
(2, 'Compartido'),
(4, 'Baja'),
(5, 'Ejemplar deteriorado'),
(6, 'En Encuadernación'),
(0, 'Disponible');

ALTER TABLE usr_socio ADD FOREIGN KEY ( cod_categoria ) REFERENCES usr_ref_categoria_socio( categorycode ) ;

ALTER TABLE `usr_persona` ADD `es_socio` INT( 1 ) UNSIGNED NOT NULL DEFAULT '0' COMMENT '1= si; 0=no';

ALTER TABLE `usr_estado` DROP `id_socio` =======

ALTER TABLE `usr_estado` DROP INDEX `id_persona` 

 ALTER TABLE `usr_estado`
  DROP `id_persona`;


ALTER TABLE usr_socio ADD FOREIGN KEY ( id_estado ) REFERENCES usr_estado( id_estado ) 


ALTER TABLE `usr_socio` ADD `activo` TINYINT( 1 ) UNSIGNED NOT NULL DEFAULT '1' AFTER `id_estado` ;

ALTER TABLE `usr_persona` DROP `activo` ;

ALTER TABLE `usr_persona` ADD `legajo` VARCHAR( 8 ) NOT NULL ;

--- PARA TESTEAR SESSIONES, PARA Q NO SE QUEDEN AFUERA

INSERT INTO `usr_estado` (`id_estado`, `regular`, `categoria`, `fuente`) VALUES
(20, 1, 'NN', 'ES UNA FUENTE DEFAULT, PREGUNTARLE A EINAR....');

INSERT INTO `usr_persona` (`id_persona`, `legajo`, `version_documento`, `nro_documento`, `tipo_documento`, `apellido`, `nombre`, `titulo`, `otros_nombres`, `iniciales`, `calle`, `barrio`, `ciudad`, `telefono`, `email`, `fax`, `msg_texto`, `alt_calle`, `alt_barrio`, `alt_ciudad`, `alt_telefono`, `nacimiento`, `fecha_alta`, `sexo`, `telefono_laboral`, `cumple_condicion`) VALUES 
(1, '26329', 'P', '27855859', '1', 'Carbone', 'Miguel', 'titulo', 'otros nombreeeeeessssssssssss', 'DGR', '1', NULL, '343978', '4227804', 'carbon@yahoo.com.ar', NULL, NULL, NULL, NULL, '7920', NULL, '2009-12-24', NULL, 'M', NULL, 0);


INSERT INTO `usr_socio` (`id_persona`, `id_socio`, `nro_socio`, `id_ui`, `cod_categoria`, `fecha_alta`, `expira`, `flags`, `password`, `last_login`, `last_change_password`, `change_password`, `cumple_requisito`, `id_estado`, `activo`) VALUES 
(1, 3, '26320', 'DEO', 'DO', NULL, NULL, NULL, 'ICy5YqxZB1uWSwcVLSNLcA', NULL, NULL, 0, NULL, 20, 1);


ALTER TABLE `usr_permiso` ADD PRIMARY KEY ( `bit` ) ;

ALTER TABLE `usr_permiso` ADD UNIQUE (`flagdesc`);

ALTER TABLE `usr_permiso` CHANGE `flag` `flag` VARCHAR( 255 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL , CHANGE `flagdesc` `flagdesc` VARCHAR( 255 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL ;


ALTER TABLE `usr_estado`  ENGINE = innodb;

ALTER TABLE `usr_ref_estado`  ENGINE = innodb;

ALTER TABLE `usr_permiso`  ENGINE = innodb;

--Se agrego en koha.conf la siguiente variable, si se setea en 1 se loguean "solos" los objetos, "en Desarrollo" ;)
debug=1

--Usuario KOHAADMIN, para el MONOOOOOOOOO
user: kohaadmin
pass: kohaadmin (cambiar pass)


INSERT INTO `usr_estado` (`id_estado`, `regular`, `categoria`, `fuente`) 
VALUES (46, 1, 'NN', 'MONO TU FUCKING KOHAADMIN SUPERLIBRARIAN');

INSERT INTO `usr_persona` (`id_persona`, `legajo`, `version_documento`, `nro_documento`, `tipo_documento`, `apellido`, `nombre`, `titulo`, `otros_nombres`, `iniciales`, `calle`, `barrio`, `ciudad`, `telefono`, `email`, `fax`, `msg_texto`, `alt_calle`, `alt_barrio`, `alt_ciudad`, `alt_telefono`, `nacimiento`, `fecha_alta`, `sexo`, `telefono_laboral`, `cumple_condicion`)
VALUES (21, '007', 'P', '27000000', '1', 'Kohaadmin', 'Kohaadmin', NULL, NULL, 'DGR', '007', NULL, '16648', '', '', NULL, NULL, NULL, NULL, '', NULL, '2009-12-23', NULL, NULL, NULL, 0);

INSERT INTO `usr_socio` (`id_persona`, `id_socio`, `nro_socio`, `id_ui`, `cod_categoria`, `fecha_alta`, `expira`, `flags`, `password`, `last_login`, `last_change_password`, `change_password`, `cumple_requisito`, `id_estado`, `activo`) 
VALUES (21, 12, 'kohaadmin', 'DEO', 'DO', NULL, NULL, 1, 'yaI/N9MQNziYMukMdHMW4w', '2009-12-13 00:00:00', '2009-12-13', 0, '0000-00-00', 46, 1);


--Modificaciones en Reservas (`circ_reserva`)
ALTER TABLE `circ_reserva`  DROP `cancellationdate`, DROP `reservenotes`, DROP `biblioitemnumber`;
ALTER TABLE `circ_reserva` CHANGE `borrowernumber` `nro_socio` VARCHAR( 16 ) NOT NULL DEFAULT '0';
ALTER TABLE `circ_reserva` DROP INDEX `IdUnico` , ADD UNIQUE `IdUnico` ( `nro_socio` , `id3` );
ALTER TABLE `circ_reserva` CHANGE `reservenumber` `id_reserva` INT( 11 ) NOT NULL AUTO_INCREMENT ,
CHANGE `reservedate` `fecha_reserva` DATE NOT NULL DEFAULT '0000-00-00',
CHANGE `notificationdate` `fecha_notificacion` DATE NULL DEFAULT NULL ,
CHANGE `reminderdate` `fecha_recodatorio` DATE NULL DEFAULT NULL ;

ALTER TABLE `circ_reserva` CHANGE `branchcode` `id_ui` VARCHAR( 4 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL;

--Se elimino la siguiente tabla, se usa usr_ref_tipo_documento (DNI, LE, LC, etc)
DROP TABLE `ref_tipo_documento`;

ALTER TABLE `cat_ref_tipo_nivel3`
  DROP `loanlength`,
  DROP `renewalsallowed`,
  DROP `rentalcharge`,
  DROP `search`,
  DROP `detail`;

ALTER TABLE `cat_ref_tipo_nivel3` CHANGE `itemtype` `id_tipo_doc` VARCHAR( 4 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL ,
CHANGE `description` `nombre` VARCHAR( 255 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL ;

UPDATE `pref_preferencia_sistema` SET `variable` = 'defaultTipoNivel3' WHERE CONVERT( `pref_preferencia_sistema`.`variable` USING utf8 ) = 'defaultitemtype' LIMIT 1 ;

--Modificaciones en Valores Autorizados

ALTER TABLE `pref_valor_autorizado` CHANGE `category` `category` CHAR( 40 );

--Se modifico en pref_informacion_referencia, campos y orden pueden ser null

ALTER TABLE `pref_informacion_referencia` CHANGE `orden` `orden` VARCHAR( 255 ) CHARACTER SET utf8 COLLATE utf8_general_ci NULL ,
CHANGE `campos` `campos` VARCHAR( 255 ) CHARACTER SET utf8 COLLATE utf8_general_ci NULL 

ALTER TABLE `cat_estructura_catalogacion` ADD `idinforef` INT( 11 ) NULL AFTER `visible` ;

DROP TABLE `pref_tabla_referencia`;
-- 
-- Estructura de tabla para la tabla `pref_tabla_referencia`
-- 

CREATE TABLE `pref_tabla_referencia` (
  `id` int(11) unsigned NOT NULL auto_increment,
  `nombre_tabla` varchar(40) NOT NULL,
  `alias_tabla` varchar(20) NOT NULL default '0',
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=3 ;

INSERT INTO `pref_tabla_referencia` (`nombre_tabla`, `alias_tabla`) VALUES
('cat_autor', 'autor'),
('cat_ref_tipo_nivel3', 'tipo_ejemplar'),
('pref_unidad_informacion', 'ui'),
('ref_idioma', 'idioma'),
('ref_pais', 'pais'),
('ref_disponibilidad', 'disponibilidad'),
('circ_ref_tipo_prestamo', 'tipo_prestamo'),
('ref_soporte', 'soporte'),
('ref_nivel_bibliografico', 'nivel_bibliografico'),
('cat_tema', 'tema');


ALTER TABLE `cat_estructura_catalogacion` ADD `idCompCliente` VARCHAR( 255 ) NOT NULL AFTER `idinforef` ;

ALTER TABLE `cat_nivel1` CHANGE `timestamp` `timestamp` TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP;

ALTER TABLE `cat_nivel1_repetible` CHANGE `timestamp` `timestamp` TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP;

-- Se modifico la tabla de cat_nivel3

ALTER TABLE `cat_nivel3` CHANGE `notforloan` `id_disponibilidad` TINYINT( 5 ) NULL DEFAULT '0';
ALTER TABLE `cat_nivel3` CHANGE `wthdrawn` `para_sala` SMALLINT( 1 ) NOT NULL DEFAULT '0';
ALTER TABLE `cat_nivel3` CHANGE `homebranch` `id_ui_origen` VARCHAR( 4 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL;
ALTER TABLE `cat_nivel3` CHANGE `holdingbranch` `id_ui_poseedora` VARCHAR( 4 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL;

--Modificaciones en PREFERENCIAS
UPDATE pref_preferencia_sistema SET type = 'text';

--Los que cambiaron a bool
UPDATE pref_preferencia_sistema SET value = '0',type = 'bool' WHERE variable = 'insecure';
UPDATE pref_preferencia_sistema SET value = '0',type = 'bool' WHERE variable = 'ldapenabled';
UPDATE pref_preferencia_sistema SET value = '1',type = 'bool' WHERE variable = 'UploadPictureFromOPAC';
UPDATE pref_preferencia_sistema SET value = '1',type = 'bool' WHERE variable = 'sanctions';

--Todos los demas bool
UPDATE pref_preferencia_sistema SET type = 'bool' WHERE variable = 'autoActivarPersona' OR variable = 'autoMemberNum' OR variable = 'CheckUpdateDataEnabled' OR variable = 'circulation' OR variable = 'EnabledMailSystem' OR variable = 'habilitar_irregulares' OR variable = 'keeppasswordalive' OR variable = 'logSearchINTRA' OR variable = 'logSearchOPAC' OR variable = 'marc' OR variable = 'opacSearchAnonymous' OR variable = 'opacUnavail' OR variable = 'print_renew' OR variable = 'reminderMail' OR variable = 'selectHomeBranch' OR variable = 'showHistoricReserves' OR variable = 'susp' OR variable = 'usercourse' OR variable = 'viewDetail' OR variable = 'virtuallibrary';

-- Los Valores Autorizados
UPDATE pref_preferencia_sistema SET options = 'dateformat', type = 'valAuto' WHERE variable = 'dateformat';
UPDATE pref_preferencia_sistema SET options = 'acquisitions', type = 'valAuto' WHERE variable = 'acquisitions';

-- Tablas de Referencia
UPDATE pref_preferencia_sistema SET options = 'ui|nombre', type = 'referencia' WHERE variable = 'defaultbranch';
UPDATE pref_preferencia_sistema SET options = 'soporte|description',value='1', type = 'referencia' WHERE variable = 'defaultsuport';
UPDATE pref_preferencia_sistema SET options = 'nivel_bibliografico|description', type = 'referencia' WHERE variable = 'defaultlevel';
UPDATE pref_preferencia_sistema SET options = 'tipo_documento_usr|descripcion', type = 'referencia' WHERE variable = 'defaultTipoDoc';
UPDATE pref_preferencia_sistema SET options = 'tipo_prestamo|description', type = 'referencia' WHERE variable = 'defaultissuetype';
UPDATE pref_preferencia_sistema SET options = 'tipo_ejemplar|nombre', type = 'referencia' WHERE variable = 'defaultTipoNivel3';
UPDATE pref_preferencia_sistema SET options = 'disponibilidad|nombre',value='0', type = 'referencia' WHERE variable = 'defaultDisponibilidad';
UPDATE pref_preferencia_sistema SET options = 'tipo_socio|description', type = 'referencia' WHERE variable = 'defaultCategoriaSocio';

--Los TextaArea
UPDATE pref_preferencia_sistema SET type = 'texta' WHERE variable = 'mailMessage' OR variable = 'reserveMessage' OR  variable = 'reminderMessage' OR  variable = 'mailMensajeVencido';

--Tipos de socios
INSERT INTO `pref_tabla_referencia` (`nombre_tabla` , `alias_tabla`) VALUES ('usr_ref_categoria_socio', 'tipo_socio');
--Tipos de documento
INSERT INTO `pref_tabla_referencia` (`nombre_tabla` , `alias_tabla`) VALUES ('usr_ref_tipo_documento', 'tipo_documento_usr');

TRUNCATE TABLE `usr_ref_tipo_documento`;
ALTER TABLE `usr_ref_tipo_documento` DROP `id_tipo_documento`;
ALTER TABLE `usr_ref_tipo_documento` ADD PRIMARY KEY ( `nombre` );

INSERT INTO `usr_ref_tipo_documento` (`nombre`, `descripcion`) VALUES ('DNI', 'DNI'),('LC', 'LC'),('PAS', 'PAS'),('LE', 'LE');

--Idioma
ALTER TABLE `ref_idioma` ADD PRIMARY KEY ( `idLanguage` ) ;

TRUNCATE pref_valor_autorizado;
INSERT INTO `pref_valor_autorizado` (`id`, `category`, `authorised_value`, `lib`) VALUES
(6, 'loan', '1', 'Para Sala'),
(7, 'loan', '0', 'Domiciliario'),
(8, 'wthdrawn', '0', 'Disponible'),
(9, 'wthdrawn', '1', 'Perdido'),
(10, 'wthdrawn', '4', 'Baja'),
(11, 'wthdrawn', '5', 'Ejemplar deteriorado'),
(12, 'wthdrawn', '6', 'En Encuadernación'),
(13, 'dateformat', 'metric', 'metric'),
(14, 'dateformat', 'us', 'us'),
(15, 'dateformat', 'iso', 'iso'),
(18, 'acquisitions', 'simple', 'simple'),
(19, 'acquisitions', 'normal', 'normal');

--HISTORICO DE CIRCULACION!!!

ALTER TABLE `rep_historial_circulacion` CHANGE `borrowernumber` `nro_socio` INT( 11 ) NOT NULL DEFAULT '0' ;
ALTER TABLE `rep_historial_circulacion` CHANGE `branchcode` `id_ui` VARCHAR( 4 ) NULL DEFAULT NULL;
ALTER TABLE `rep_historial_circulacion` CHANGE `type` `tipo` VARCHAR( 15 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL ,
CHANGE `date` `fecha` DATE NOT NULL DEFAULT '0000-00-00',
CHANGE `end_date` `fecha_fin` DATE NULL DEFAULT NULL ,
CHANGE `issuetype` `tipo_prestamo` CHAR( 2 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL ;

-- se modifico la tabla cat_estructura_catalogacion, se agrego el siguiente campo

ALTER TABLE `cat_estructura_catalogacion` ADD `fijo` TINYINT( 1 ) NOT NULL DEFAULT '0' COMMENT 'modificable = 0, No modificable = 1' AFTER `idCompCliente` ;

ALTER TABLE `cat_estructura_catalogacion` ADD `repetible` TINYINT( 1 ) NOT NULL DEFAULT '0' COMMENT 'repetible = 1 (es petible)' AFTER `fijo` ;

ALTER TABLE `cat_nivel1` CHANGE `autor` `autor` INT( 11 ) NULL 

insert into `pref_tabla_referencia`(`id`,`nombre_tabla`,`alias_tabla`) values ( NULL,'ref_estado','estado')

--Poner rename de ref_disponibilidad y agregar DISPONIBILIDAD GASPAR


-- ESTO ES LO MINIMO E INDISPENSABLE PARA EL CATALOGO DEBE ESTAR SI O SI


INSERT INTO `pref_informacion_referencia` (`idinforef`, `idestcat`, `referencia`, `orden`, `campos`, `separador`) VALUES 
(1, 0, 'autores', 'nacionalidad', 'id, nombre, apellido, nacionalidad, completo', '?'),
(2, 0, 'temas', 'nombre', 'nombre', ','),
(3, 0, 'bibliolevel', 'description', 'description', ','),
(4, 0, 'soporte', 'description', 'idSupport, description', ','),
(5, 0, 'countries', 'printable_name', 'printable_name', '/'),
(6, 0, 'languages', 'description', 'description', '/'),
(7, 0, 'ui', 'nombre', 'id_ui, nombre', ','),
(8, 0, 'tipo_ejemplar', 'nombre', 'id_tipo_doc, nombre', ','),
(9, 0, 'disponibilidad', 'nombre', 'codigo, nombre', ',');



INSERT INTO `cat_estructura_catalogacion` (`id`, `campo`, `subcampo`, `itemtype`, `liblibrarian`, `tipo`, `referencia`, `nivel`, `obligatorio`, `intranet_habilitado`, `visible`, `idinforef`, `idCompCliente`, `fijo`) VALUES 
(51, '245', 'a', 'ALL', 'Título', 'text', 0, 1, 1, 1, 1, 0, '1', 1),
(52, '995', 'd', 'ALL', 'Unidad de Información de Origen', 'combo', 1, 3, 1, 2, 1, 7, '2', 1),
(53, '995', 'c', 'ALL', 'Unidad de Información', 'combo', 1, 3, 1, 3, 1, 7, '3', 1),
(54, '995', 'o', 'ALL', 'Disponibilidad', 'combo', 1, 3, 1, 4, 1, 9, '4', 1),
(55, '995', 'e', 'ALL', 'Estado', 'combo', 1, 3, 1, 5, 1, 9, '5', 1),
(56, '910', 'a', 'ALL', 'Tipo de Documento', 'combo', 1, 2, 1, 6, 1, 8, '6', 1);

-- FIN ESTO ES LO MINIMO E INDISPENSABLE PARA EL CATALOGO DEBE ESTAR SI O SI


-- se creo la tabla de disponibilidad

CREATE TABLE `ref_disponibilidad` (
  `codigo` tinyint(5) NOT NULL default '0',
  `nombre` varchar(255) NOT NULL default '',
  PRIMARY KEY  (`codigo`),
  UNIQUE KEY `nombre` (`nombre`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


ALTER TABLE `cat_nivel2` CHANGE `id2` `id2` INT( 11 ) NOT NULL AUTO_INCREMENT ,
CHANGE `tipo_documento` `tipo_documento` VARCHAR( 4 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL ,
CHANGE `timestamp` `timestamp` TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ,
CHANGE `id1` `id1` INT( 11 ) NOT NULL ,
CHANGE `nivel_bibliografico` `nivel_bibliografico` VARCHAR( 2 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL ,
CHANGE `soporte` `soporte` VARCHAR( 3 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL ,
CHANGE `pais_publicacion` `pais_publicacion` CHAR( 2 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL ,
CHANGE `lenguaje` `lenguaje` CHAR( 2 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL ,
CHANGE `ciudad_publicacion` `ciudad_publicacion` VARCHAR( 20 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL ,
CHANGE `anio_publicacion` `anio_publicacion` VARCHAR( 15 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL 

-- se modifico el campo para_sala a id_estado en cat_nivel3, ahora id_estado es una referencia a ref_estado
 ALTER TABLE `cat_nivel3` CHANGE `para_sala` `id_estado` TINYINT( 5 ) NOT NULL DEFAULT '0' 

-- se creo la siguiente tabla para manejar los estados del ejemplar
CREATE TABLE IF NOT EXISTS `ref_estado` (
  `codigo` tinyint(5) NOT NULL default '0',
  `nombre` varchar(255) NOT NULL default '',
  PRIMARY KEY  (`codigo`),
  UNIQUE KEY `nombre` (`nombre`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Volcar la base de datos para la tabla `ref_estado`
--

INSERT INTO `ref_estado` (`codigo`, `nombre`) VALUES
(4, 'Baja'),
(2, 'Compartido'),
(0, 'Disponible'),
(5, 'Ejemplar deteriorado'),
(6, 'En Encuadernación'),
(1, 'Perdido');



CREATE TABLE IF NOT EXISTS `ref_disponibilidad` (
  `codigo` tinyint(5) NOT NULL default '0',
  `nombre` varchar(255) NOT NULL default '',
  PRIMARY KEY  (`codigo`),
  UNIQUE KEY `nombre` (`nombre`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--
-- Volcar la base de datos para la tabla `ref_disponibilidad`
--

INSERT INTO `ref_disponibilidad` (`codigo`, `nombre`) VALUES
(0, 'Domiciliario'),
(1, 'Para Sala'),
(2, 'Descarga');

--
-- Para PRESTAMOS!!
--

DROP TABLE`circ_prestamo`;
CREATE TABLE `circ_prestamo` (
  `id_prestamo` int(11) NOT NULL auto_increment,
  `id3` int(11) NOT NULL,
  `nro_socio` int(11) NOT NULL default '0',
  `tipo_prestamo` char(2) NOT NULL default 'DO',
  `fecha_prestamo` date default NULL,
  `id_ui` char(4) default NULL,
  `id_ui_prestamo` char(4) default NULL,
  `fecha_devolucion` date default NULL,
  `renovaciones` tinyint(4) default NULL,
  `fecha_ultima_renovacion` date default NULL,
  `timestamp` timestamp NOT NULL default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP,
  PRIMARY KEY  (`id_prestamo`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;

-- Sanciones!!

 ALTER TABLE `circ_sancion` CHANGE `sanctionnumber` `id_sancion` INT( 11 ) NOT NULL AUTO_INCREMENT ,
CHANGE `sanctiontypecode` `tipo_sancion` INT( 11 ) NULL DEFAULT '0',
CHANGE `reservenumber` `id_reserva` INT( 11 ) NULL DEFAULT NULL ,
CHANGE `borrowernumber` `nro_socio` INT( 11 ) NOT NULL DEFAULT '0',
CHANGE `startdate` `fecha_comienzo` DATE NOT NULL DEFAULT '0000-00-00',
CHANGE `enddate` `fecha_final` DATE NOT NULL DEFAULT '0000-00-00',
CHANGE `delaydays` `dias_sancion` INT( 11 ) NULL DEFAULT '0',
CHANGE `itemnumber` `id3` INT( 11 ) NULL DEFAULT NULL ;

ALTER TABLE `circ_sancion` ADD INDEX ( `nro_socio` ) ;

ALTER TABLE `rep_historial_sancion` CHANGE `id` `id` INT( 11 ) NOT NULL AUTO_INCREMENT ,
CHANGE `type` `tipo` VARCHAR( 15 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL ,
CHANGE `borrowernumber` `nro_socio` INT( 11 ) NOT NULL DEFAULT '0',
CHANGE `responsable` `responsable` VARCHAR( 20 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL ,
CHANGE `timestamp` `timestamp` TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ,
CHANGE `date` `fecha` DATE NOT NULL DEFAULT '0000-00-00',
CHANGE `end_date` `fecha_final` DATE NULL DEFAULT NULL ,
CHANGE `sanctiontypecode` `tipo_sancion` INT( 11 ) NULL DEFAULT '0' ;

-- CAMBIOS GASPAREÑOS EL 23/03/2009

ALTER TABLE `circ_prestamo` CHANGE `id_ui` `id_ui_origen` CHAR( 4 ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NULL DEFAULT NULL;

ALTER TABLE `circ_prestamo` CHANGE `fecha_prestamo` `fecha_prestamo` VARCHAR( 20 ) NULL DEFAULT NULL ,
CHANGE `fecha_devolucion` `fecha_devolucion` VARCHAR( 20 ) NULL DEFAULT NULL ,
CHANGE `fecha_ultima_renovacion` `fecha_ultima_renovacion` VARCHAR( 20 ) NULL DEFAULT NULL ;
 ALTER TABLE `circ_sancion` ADD INDEX ( `nro_socio` ) ;


ALTER TABLE circ_reserva CHANGE fecha_reserva fecha_reserva VARCHAR( 20 ) NOT NULL DEFAULT '0000-00-00' ,
CHANGE fecha_notificacion fecha_notificacion VARCHAR( 20 ) NULL DEFAULT NULL ,
CHANGE fecha_recodatorio fecha_recodatorio VARCHAR( 20 ) NULL DEFAULT NULL ;