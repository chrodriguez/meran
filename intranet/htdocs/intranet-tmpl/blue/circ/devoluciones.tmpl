[% INCLUDE "intranet-top.inc" %]

<script src="/intranet-tmpl/blue/includes/circulacion.js"></script>

<script language="javascript" type="text/javascript">

function inicializar(){
	USUARIO= new objeto_usuario();
	USUARIO.ID = 0;
	USUARIO.text = '';

	$('#nro_socio_hidden').val('')
}

function onCompleteAutocompleteUsuarios(){
	var nro_socio= $('#nro_socio_hidden').val();
	USUARIO= new objeto_usuario();
	USUARIO.text= $('#usuarioAutocomplete').val();
	USUARIO.ID= nro_socio;
	//detalleUsuario esta implementado en circulacion,js
	detalleUsuario(nro_socio);
	detallePrestamos(nro_socio, updateInfoPrestamos);
	detalleSanciones(nro_socio);
}

function onCompleteAutocompleteBarcodesPrestados(){
	var prestamo= $('#prestamo_hidden').val();
	//detalleUsuario esta implementado en circulacion,js
	getSocioFromPrestamo(prestamo);
}

function getSocioFromPrestamo(prestamo){

	objAH=new AjaxHelper(updateGetSocioFromPrestamo);
	objAH.debug= true;
	objAH.url= "/cgi-bin/koha/circ/circulacionDB.pl";
	objAH.prestamo= prestamo;
	objAH.tipoAccion= "CIRCULACION_RAPIDA_OBTENER_SOCIO";
	//se envia la consulta
	objAH.sendToServer();
}

function updateGetSocioFromPrestamo(responseText){
	var socio= JSONstring.toObject(responseText);

	USUARIO= new objeto_usuario();
	USUARIO.text= socio.apeYNom;
	USUARIO.ID= socio.nro_socio;

	detalleUsuario(USUARIO.ID);
	detalleSanciones(USUARIO.ID);
}

function devolverPrestamo(accion,funcion){

	objAH=new AjaxHelper(funcion);
	objAH.debug= true;
	objAH.url= '/cgi-bin/koha/circ/circulacionDB.pl';
	objAH.tipoAccion= accion;
	objAH.datosArray= [$('#prestamo_hidden').val()];
	objAH.nro_socio= USUARIO.ID;
	//se envia la consulta
	objAH.sendToServer();
}

$(document).ready(function() {
	//se crea el autocomplete para buscar el usuario
	CrearAutocompleteUsuarios({	IdInput: 'usuarioAutocomplete', 
								IdInputHidden: 'nro_socio_hidden', 
								callBackFunction: onCompleteAutocompleteUsuarios
						});

	//se crea el autocomplete para buscar por codigo de barras
	CrearAutocompleteBarcodesPrestados({	IdInput: 'barcode', 
											IdInputHidden: 'prestamo_hidden', 
											callBackFunction: onCompleteAutocompleteBarcodesPrestados
										});
});


</script>

<table width="100%"  border="0" cellpadding="0" cellspacing="0" align="center">
	<tr>
		<td class="pagetitle" >
			Devoluciones y Renovaciones
		</td>
	</tr>
	<tr>
		<td class="lineagruesa"  align="left" colspan="3"></td>
	</tr>
</table>

<br>
<div id="confirmar_div"></div>
<br>

<div id="buscarUsuario">
<table border="0" cellpadding="0" cellspacing="0"  align="center" width="100%">
	<tr class="tablaresultadoTitle">
		<td align="left" valign="top">
		<img src="[% themelang %]/images/izquierda.png">
		</td>
		<td>
			<b>Ingrese Apellido y Nombres, DNI o Legajo del usuario</b>
		</td>
		<td valign="top" align="right">
		<img src="[% themelang %]/images/derecha.png">
		</td>
	</tr>
	<tr><td colspan="3">&nbsp;</td></tr>
	<tr>
		<td width="1%">&nbsp;</td>
		<td align="center">
			<input id="usuarioAutocomplete" type="text" class="inputFontNormal" size="40">
			<input id="nro_socio_hidden" type="hidden">
		</td>
		<td width="1%">&nbsp;</td>
	</tr>
</table>
</div>

<div id="buscarCodigoDeBarras">
<table border="0" cellpadding="0" cellspacing="0"  align="center" width="100%">
	<tr class="tablaresultadoTitle">
		<td align="left" valign="top">
		<img src="[% themelang %]/images/izquierda.png">
		</td>
		<td>
			<b>Ingrese el c√≥digo de barras</b>
		</td>
		<td valign="top" align="right">
		<img src="[% themelang %]/images/derecha.png">
		</td>
	</tr>
	<tr><td colspan="3">&nbsp;</td></tr>
	<tr>
		<td width="1%">&nbsp;</td>
		<td align="center">
			<input id="barcode" type="text" class="inputFontNormal" size="40">
			<input id="barcode_hidden" type="hidden">
			<input id="prestamo_hidden" type="hidden">
		</td>
		<td width="1%">&nbsp;</td>
	</tr>
</table>
</div>

<div id="botonDevolver">
	 <p align="center">
        <input type="image" BORDER=0 
        src="[% themelang %]/images/item-return.png" 
        title="Devolver" 
        onClick="devolverPrestamo('DEVOLUCION',generaDivDevolucion);">
    
		<!--<input type="image" 
		src="[% themelang %]/images/renew.png" title="Renovar" 
		onClick="realizarAccion('RENOVACION','chkboxPrestamos',generaDivRenovacion);">-->
    </p>
</div>

<!-- DELTALLE DEL USUARIO -->
<div id="detalleUsuario"></div>
<!-- DELTALLE DE SANCIONES -->
<div id="sanciones"></div>
<!-- DETALLE DE PRESTAMOS -->
<div id="tablaPrestamos"></div>

[% INCLUDE "intranet-bottom.inc" %]
