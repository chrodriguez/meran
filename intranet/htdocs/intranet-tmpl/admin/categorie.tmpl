[% INCLUDE "intranet-top.inc" %]
[% USE HTML %]
[% IF add_form %]
	<script>
	function swap(id,src){
	document.getElementById(id).src=src;
	}

	function _(s) { return s } // dummy function for gettext
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function isNotNull(f,noalert) {
		if (f.value.length ==0) {
   return false;
		}
		return true;
	}
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function toUC(f) {
		var x=f.value.toUpperCase();
		f.value=x;
		return true;
	}
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function isNum(v,maybenull) {
	var n = new Number(v.value);
	if (isNaN(n)) {
		return false;
		}
	if (maybenull==0 && v.value=='') {
		return false;
	}
	return true;
	}
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function isDate(f) {
		var t = Fecha.parse(f.value);
		if (isNaN(t)) {
			return false;
		}
	}
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	function Check(f) {
		var ok=1;
		var _alertString="";
		var alertString2;
		if (f.categorycode.value.length==0) {
			_alertString += "\n- " + _("falta el codigo de categoria");
		}
//		alert(window.document.Aform.description.value);
		if (!(isNotNull(window.document.Aform.description,1))) {
			_alertString += "\n- " + _("falta la descripcion");
		}
		if (!isNum(f.upperagelimit,0)) {
			_alertString += "\n- " + _("el limite superior de edad no es un numero");
		}
		if (_alertString.length==0) {
			document.Aform.submit();
		} else {
			alertString2  = _("El formulario no puede ser enviado por alguno de los siguientes problemas");
			alertString2 += "\n------------------------------------------------------------------------------------\n";
			alertString2 += _alertString;
			alert(alertString2);
		}
	}
	</SCRIPT>

	[% IF categorycode %]
        <div class="titulos_interior">[% "Modificar Categor&iacute;a" | i18n %]</div>
	[% ELSE %]
        <div class="titulos_interior">[% "Agregar Categor&iacute;a" | i18n %]</div>
	[% END %]
	
	<form action=[% script_name %] name=Aform method=post>
	<input type=hidden name=op value='add_validate'>
	<input type=hidden name=checked value=0>

	<table>
	[% IF categorycode %]
		<tr>
			<td>[% "C&oacute;digo de categor&iacute;a" | i18n %]</td>
			<td>
				[% categorycode %]
				<input type=hidden name=categorycode value=[% categorycode %]>
			</td>
		</tr>
	[% ELSE %]
		<tr>
			<td>[% "C&oacute;digo de categor&iacute;a" | i18n %]</td>
			<td>
				<input type=text name=categorycode size=3 maxlength=2 onBlur=toUC(this)>
			</td>
		</tr>
	[% END %]

		<tr>
			<td>[% "Descripci&oacute;n" | i18n %]</td>
			<td>
				<input type=text name=description size=40 maxlength=80 value="[% HTML.escape(description) %]">
				&nbsp;
			</td>
		</tr>
		<tr>
			<td>[% "Per&iacute;odo de inscripci&oacute;n" | i18n %]</td>
			<td>
				<input type=text name=enrolmentperiod size=3 maxlength=2 value="[% enrolmentperiod %]">
			</td>
		</tr>
		<tr>
			<td>[% "L&iacute;mite superior de edad "| i18n %]</td>
			<td>
				<input type=text name=upperagelimit size=3 maxlength=3 value="[% upperagelimit %]">
			</td>
		</tr>
		<tr>
			<td>[% "Edad Requerida" | i18n %]</td>
			<td>
				<input type=text name=dateofbirthrequired value="[% dateofbirthrequired %]" size=3 maxlength=2>
			</td>
		</tr>
		<tr>
			<td>[% "Tarifa de inscripci&oacute;n" | i18n %]</td>
			<td>
				<input type=text name=enrolmentfee value="[% enrolmentfee  %]">
			</td>
		</tr>
		<tr>
			<td>[ "Se necesita nota de atraso" | i18n %]</td>
			<td>
				<select name="overduenoticerequired">
					<option [% UNLESS overduenoticerequired %] selected [% END %] value="0">No</option>
					<option [% IF overduenoticerequired %] selected [% END %] value="1">Si</option>
				</select>
			</td>
		</tr>
		<tr>
			<td>[% "L&iacute;mite de pr&eacute;stamo" | i18n %]</td>
			<td>
				<input type=text name=issuelimit size=2 maxlength=2 value="[% issuelimit %]">
			</td>
		</tr>
		<tr>
			<td>[% "D&iacute;as de pr&eacute;stamo" | i18n %]</td>
			<td>
				<input type=text name=borrowingdays value="[% borrowingdays %]">
			</td>
		</tr>

		<tr>
			<td>[% "Costo de reserva" | i18n %]</td>
			<td>
				<input type=text name=reservefee value="[% reservefee %]">
			</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td>
			<input type="image" alt="Guardar Cambios"  src="[% interface %]/[% themelang %]/images/guardar.png" onclick="Aform.submit">
                [% PERL %]
                                print C4::AR::Filtros::to_Button( 
                                                                    text    =>  "[% 'Buscar' | i18n %]",
                                                                    boton   =>  "boton_buscar",
                                                                    onClick =>  "Aform.submit();",
                                                                    title   =>  "[% 'Buscar usuario' | i18n %]",
                                        ) ;
                [% END %]
			</td>
		</tr>
	</table>
	</form>

[% END %]

[% IF add_validate %]
	[% "Registro de datos" | i18n %]
	<form action=[% script_name %] method=post>
		<input type=submit value=OK>
	</form>
[% END %]

[% IF delete_confirm %]
	[% "TOTAL"  | i18n %]: [% categorycode %] : [% total %]<br>

	<table border=0 cellspacing=0 cellpadding=5>
		<tr class="tablaresultadoTitle">
			<td>
				<b>[% "C&oacute;digo de categor&iacute;a" | i18n %]</b>
			</td>
			<td>
				[% categorycode %]
			</td>
		</tr>
        	<form action='[% script_name %]' method=post>
			<input type=hidden name=op value=[% delete_confirmed %]>
			<input type=hidden name=categorycode value=[% categorycode %]>        
		<tr class="tablaresultadoTitle">
			<td>[% "Descripci&oacute;n" | i18n %]</td>
			<td>[% description %]</td>
		</tr>
		<tr >
			<td>[% "Per&iacute;odo de inscripci&oacute;n" | i18n %]</td>
			<td>[% enrolmentperiod %]</td>
		</tr>
		<tr>
			<td>[% "Upperage limit" | i18n %]</td>
			<td>[% upperagelimit %]</td>
		</tr>
		<tr>
			<td>[% "Edad Requerida" | i18n %]</td>
			<td>[% dateofbirthrequired %]</td>
		</tr>
		<tr>
			<td>[% "Tipo de multa" | i18n %]</td>
			<td>[% finetype %]</td>
		</tr>
		<tr>
			<td>[% "Tarifa de inscripci&oacute;n" | i18n %]</td>
			<td>[% enrolmentfee %]</td>
		</tr>
		<tr>
			<td>[% "Se necesita nota de atraso" | i18n %]</td>
			<td>[% IF overduenoticerequired %]
                                                        Si
                                                    [% ELSE %]
                                                        No
                                                    [% END %]
                        </td>
		</tr>
		<tr>
			<td>[% "L&iacute;mite de pr&eacute;stamo" | i18n %]</td>
			<td>[% issuelimit %]</td>
		</tr>
		<tr>
			<td>[% "D&iacute;s de pr&eacute;stamo" | i18n %]</td>
			<td>[% borrowingdays %]</td>
		</tr>
		<tr>
			<td>[% "Costo de reserva" | i18n %]</td>
			<td>[% reservefee %]</td>
		</tr>
		[% IF totalgtzero %]
                        <tr>
                                <td colspan=2 align=center><b>This record is used [% total %] times. Deletion not possible</b></td>
                        </tr>
                        </form>
                        <tr>
                                <td colspan=2>
                                        <form action='[% script_name %]' method=post>
                                        <a onMouseOut="swap('save','[% themelang %]/images/guardar.png')" onMouseOver="swap('save','[% themelang %]/images/guardarbis.png')" onClick="Aform.submit()" >
                                        <img name="save" id="save" alt="Guardar" src="[% themelang %]/images/guardar.png" border="0"></a>
                                                                                
                                        <input type=submit value=OK>
                                        </form>
                                </td>
                        </tr>
                        [% ELSE %]
                        <tr>
                                <td colspan=2 align=center>[% "CONFIRME BORRADO" | i18n %]</td>
                        </tr>
                        <tr>
                                <td><INPUT type=submit value='SI'></form></td>
                                <td><form action='[% script_name %]' method=post><input type=submit value=NO></form></td>
                        </tr>
                    </table>
		[% END %]

[% END %]

[% IF delete_confirmed %]
	[% "Borrado de datos" | i18n %]
        <form action='[% script_name %]' method=post>
        <input type=submit value=OK>
        </form>

[% END %]

[% IF else %]
<div class="titulos_interior">[% "Administraci&oacute;n de Categor&iacute;as"  | i18n %]</div>

[% IF searchfield %]
<!-- FIXME posible XSS -->
        [% "Ha Buscado por"  | i18n %][% searchfield %]
[% END %]
        <table>
                <tr>
                <form action='[% script_name %]' method=post name="form1">
                        <td>
                                <input type=text name=description value=[% searchfield %]>
                        </td>
                        <td> 
                                <input type="image" name="go" id="go" alt="Comenzar b&uacute;squeda" src="[% themelang %]/images/boton-buscar.png" border="0" onClick="form1.submit()">
                        
                        </td>
                </form>
                </tr>
        </table>
        <table border=0 cellspacing=0 cellpadding="0" width="100%">
                <tr class="tablaresultadoTitle">

                        <td >[% "Categor&iacute;a" | i18n %]</td>
                        <td width="10%">[% "Descripci&oacute;n" | i18n %]</td>
                        <td >[% "Per&iacute;odo de inscripci&oacute;n "| i18n %]</td>
                        <td >[% "Tarifa de inscripci&oacute;n "| i18n %]</td>
                        <td >[% "L&iacute;mite superior de edad "| i18n %]</td>
                        <td width="8%">[% "Edad Requerida "| i18n %]</td>
                        <td width="5%">[% "Multa "| i18n %]</td>
                        <td width="7%">[% "Atrasado "| i18n %]</td>
                        <td >[% "L&iacute;mite de pr&eacute;stamo" | i18n %]</td>
                        <td >[% "D&iacute;as de pr&eacute;stamo "| i18n %]</td>
                        <td width="6%">[% "Reserva "| i18n %]</td>
                        <td width="6%">[% "Editar " | i18n %]</td>
                        <td >[% "Eliminar"  | i18n %]</td>
                        
                </tr>
               [% FOREACH loop %]
                        <tr valign="middle">
                               
                                <td class="[% clase %]" >[% categorycode %]</td>
                                <td class="[% clase %]" >[% description %]</td>
                                <td class="[% clase %]" >[% enrolmentperiod %]</td>
                                <td class="[% clase %]" >[% enrolmentfee %]</td>
                                <td class="[% clase %]" >[% upperagelimit %]</td>
                                <td class="[% clase %]" >[% dateofbirthrequired %]</td>
                                <td class="[% clase %]" >[% finetype %]</td>
                                <td class="[% clase %]" >
                                [% IF overduenoticerequired %]
                                        <i>[% "Si" | i18n %]</i>
                                [% ELSE %]
                                        <i>[% "No" | i18n %]</i>
                                [% END %]
                                </td>
                                <td class="[% clase %]">[% issuelimit %]</td>
                                <td class="[% clase %]">[% borrowingdays %]</td>
                                <td class="[% clase %]">[% reservefee %]</td>
                                <td align="center"class="[% clase %]">
                                    <a  href="[% script_name %]?op=add_form&categorycode=[% categorycode %]"><img src="[% interface %]/[% themelang %]/images/editar.png"  ALT="Editar" hspace=0 vspace=0 border=0></a>
                                </td>
                                <td align="center"class="[% clase %]">
                                    <a  href="[% script_name %]?op=delete_confirm&categorycode=[% categorycode %]"><img src="[% interface  %]/[% themelang %]/images/borrar.png" ALT="Eliminar" border="0"></a>
                                </td>
                               
                        </tr>
                [% END %]
                <tr valign=bottom> 
                        <td class="lineafinaltabla"  align="left" colspan="15"></td>
                </tr>
        
        </table>
                <center>
                <p><form action='[% script_name %]' method=post name=form2>
                        <input type=hidden name=op value=add_form>
<!--         <input type="image" alt="Agregar Categor&iacute;a"  src="[% interface %]/[% themelang %]/images/agregar.png" onclick="form2.submit"> -->
        <br>
       [% PERL %]
                                print C4::AR::Filtros::to_Button( 
                                                                    text    =>  "[% 'Agregar Categor&iacute;a' | i18n %]",
                                                                    boton   =>  "boton_buscar",
                                                                    onClick =>  "form2.submit();",
                                                                    title   =>  "[% 'Agregar Categor&iacute;a' | i18n %]",
                                        ) ;
        [% END %]        
                </form></p>
                </center>
[% END %]

[% INCLUDE "intranet-bottom.inc" %]
