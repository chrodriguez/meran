<script type="text/javascript">
      $(document).ready(function() {
        makeToggle('datos_tabla_div','trigger',null,false);
      });
</script>

<fieldset class="resultados_busqueda">
    <legend class="titulo_legend trigger click">[% "Resultados de la b&uacute;squeda" | i18n %]:</legend>
        <div class="datos_tabla_div" id="datos_tabla_div">
            <div class="resultados_consulta">[% "Total de registros" | i18n %]: [% cantidad %]  </div>
            <div class="contenedor_paginador">[% paginador %]</div>
                <table id="tablaResult" class="datos_tabla" border=0 cellspacing=0 cellpadding=0 width="100%">
                    <tr>
                        <th width="20%" class="titulo_tabla_resultado click" onclick="ordenar('surname')" 
                            title='[% "Ordenar por usuario" | i18n %]'>
                            [% "Usuario" | i18n %]
                        </th>
                        <th width="30%" class="titulo_tabla_resultado click" onclick="ordenar('numero')" 
                            title='[% "Ordenar por tÃ­tulo" | i18n %]'>
                            [% "T&iacute;tulo" | i18n %]
                        </th>
                        <th class="titulo_tabla_resultado click" onclick="ordenar('fecha')" title='[% "Ordenar por fecha" | i18n %]'>
                            [% "Fecha" | i18n %]
                        </th>
                        <th class="titulo_tabla_resultado click" onclick="ordenar('operacion')" title='[% "Ordenar por operaci&oacute;n" | i18n %]'>
                            [% "Operaci&oacute;n" | i18n %]
                        </th>
                        <th class="titulo_tabla_resultado click" onclick="ordenar('tipo')" title='[% "Ordenar por tipo" | i18n %]'>
                            [% "Tipo" | i18n %]
                        </th>
                        <th class="titulo_tabla_resultado">[% "Acciones" | i18n %]</th>
                    </tr>
                
                [% FOREACH registro IN registros %]
                    
                    <tr align='center' >
                        <td> 
                            [% PERL %]
                                print C4::AR::Filtros::link_to( text =>     "[% registro.nro_socio %] ([% registro.apellido %] [% registro.nombre %] )",
                                                                url =>      "/cgi-bin/koha/usuarios/reales/datosUsuario.pl", 
                                                                params =>   ["nro_socio=[% registro.nro_socio %]"],
                                                                title =>    "[% 'Mostrar Detalle del Usuario' | i18n %]"
                                                            ) ;
                            [% END %]
                        </td>
                        <td>
                            [% PERL %]
                                print C4::AR::Filtros::link_to( text    =>  "[% registro.titulo %]",
                                                                url     =>  "/cgi-bin/koha/catalogacion/estructura/detalle.pl", 
                                                                params  =>  ["id1=[% registro.id1 %]"],
                                                                title   =>  "[% 'Mostrar Detalle del Ejemplar' | i18n %]"
                                                            ) ;
                            [% END %]
                        </td>
                        <td> [% registro.fecha %] </td>
                        <td> [% registro.operacion %]</td>
                        <td> [% registro.tipo %]</td>
                        <td> 

                            [% PERL %]
                                    print C4::AR::Filtros::to_Icon(   
                                                                        boton   => "icon_mas",
                                                                        onClick => "agregarNota([% registro.idModificacion %]);",
                                                                        title   => "[% 'Agregar nota' | i18n %]",
                                            ) ;
                            [% END %]

                            <div id="add_note_[% registro.idModificacion %]" style="display: none">
                                <ul>
                                    <li>
                            <textarea  id="nota_[% registro.idModificacion %]" cols="45" rows="10">[% registro.nota %]</textarea>
                                    </li>
                                    <li>
                                        <div class="buttonContainerHorizontal">
                                        [% PERL %]
                                                        print C4::AR::Filtros::to_Button( 
                                                                    text        =>  "[% 'Guardar nota' | i18n %]",
                                                                    boton       =>  "boton_agregar",
                                                                    onClick     =>  "guardarNota([% registro.idModificacion %]);",
                                                                    alternClass => 'botonCentrado'
                                                                ) ;
                                        [% END %]
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        <script>$('#add_note_' + [% registro.idModificacion %]).dialog({ width: 510, autoOpen: false });</script>

                        [% IF registro.nota != '' %]

                                [% PERL %]
                                        print C4::AR::Filtros::to_Icon(   
                                                                boton       => "icon_globo",
                                                                onClick     => "verNota([% registro.idModificacion %]);",
                                                                title       => "[% 'Ver nota' | i18n %]",
                                                                alternClass => 'botonCentrado'
                                                ) ;
                                [% END %]
    
                                <div id="view_note_[% registro.idModificacion %]" style="display: none">[% registro.nota %]</div>
                        <script>$('#view_note_' + [% registro.idModificacion %]).dialog({ width: 510, autoOpen: false });</script>
                        [% END %]
                        </td>
                        
                    </tr>
                    
                [% END %]
                
                </table>
        </div>
</fieldset>
