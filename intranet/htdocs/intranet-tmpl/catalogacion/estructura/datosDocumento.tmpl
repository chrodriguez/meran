[% INCLUDE "intranet-top.inc" %]

<script src="/intranet-tmpl/includes/CombosHelper.js"></script> 
<!-- para manejar la ventana de campos MARC -->
<script src="/intranet-tmpl/includes/popups/helpCamposMARC.js"></script>
<!-- para manejar el ABM del catalogo -->
<script src="/intranet-tmpl/includes/catalogacion-min.js"></script>
<script src="/intranet-tmpl/includes/admin/tablasDeReferencia.js"></script>
<script src="/includes/jquery/jquery.jeditable.js"></script>


[% INCLUDE 'datePicker.inc' %]

[% INCLUDE "FormValidateHelper.inc" %]

[% INCLUDE  'WindowHelper.inc'  %]

[% INCLUDE  'AutocompleteHelper.inc'  %] 



<script type="text/javascript">

var TIENE_NIVEL_2 = 0;

function showTipoDocumento(){
// parece q tiene q estar siempre, pq aunque se este modificando puede q se quiera agregar un nivel2 y habria q seleccionar el tipo_de_doc
    if( TIENE_NIVEL_2 > 0){
//         $('#div_combo_tipo_documento').hide();
    }else{
//         $('#div_combo_tipo_documento').show();
    }
}

//Funcion que se ejecuta cuando se carga la pagina, dependiendo de donde viene ejecuta las funciones correspondientes.
$(document).ready( function() {
	//oculto todas las tabls
	_showAndHiddeEstructuraDelNivel(0);
//     var _modificar = false;

    TIENE_NIVEL_2 = [% tiene_nivel_2 %];

	[% IF tipoAccion == "MODIFICAR_NIVEL_1" %]
		params= new objeto_params();
		params.id1= [% id1 %];
		params.id2= [% id2 %];
		params.id3= [% id3 %];
		params.tipoAccion= '[% tipoAccion %]';
		cargarNivel1(params);
        MODIFICAR = 1;
        FROM_DETALLE_REGISTRO = 1;
//         _modificar = true;
	[% ELSE %] 
		[% IF tipoAccion == "MODIFICAR_NIVEL_2" %]
			params= new objeto_params();
			params.id1= [% id1 %];
			params.id2= [% id2 %];
			params.id3= [% id3 %];
			params.tipoAccion= '[% tipoAccion %]';
			cargarNivel1(params);
            MODIFICAR = 1;
            FROM_DETALLE_REGISTRO = 1;
//             _modificar = true;
		[% ELSE %]	
			[% IF tipoAccion == "MODIFICAR_NIVEL_3" %]
				params= new objeto_params();
				params.id1= [% id1 %];
				params.id2= [% id2 %];
				params.id3= [% id3 %];
				params.tipoAccion= '[% tipoAccion %]';
				cargarNivel1(params);
                MODIFICAR = 1;
                FROM_DETALLE_REGISTRO = 1;
//                 _modificar = true;
			[% END %]
		[% END %]
	[% END %]

//     if(_modificar){
//         $('#titulo_modificar').show();
//         showTipoDocumento();
//     }else{
//         $('#titulo_agregar').show();
//     }

} );

</script>

[% PERL %]
    print C4::AR::Filtros::ayuda_marc() ;
[% END %]

<!--<div id="titulo_agregar" style="display:none">
    <p class="titulos" >[% "Agregar Documento" | i18n %]</p>
</div>
<div id="titulo_modificar" style="display:none">
    <p class="titulos" >[% "Modificar Documento" | i18n %]</p>
</div>-->
<div id="abm_tablas_referencia"><div id="abm_tablas_referencia_content"></div></div>

<div id="div_combo_tipo_documento">
[% "Esquema de ingreso de datos tipo:" | i18n %] [% comboTipoDocumento %]

                [% PERL %]
                        print C4::AR::Filtros::to_Icon(   
                                                            boton   => "icon_buscar",
                                                            onClick => "mostrarEstructuraDelNivel1();",
                                                            title   => "[% 'Buscar' | i18n %]",
                                ) ;
                [% END %]

</div>


<div class="todo">

<div class="lateral">
    <div class="nivel1Barra">
        <fieldset id="nivel1" class="nivel1Lateral"></fieldset>
    </div>
    <div class="nivel2Barra">
        <div id="nivel2" class="nivel2Lateral"></div>
    </div>
</div>   <!--END <div class="lateral">-->

<div id="centro" class="centro">
<!-- aca se va mostrando la accion que se va realizando -->
<div id="estado_accion" class="titulos" style="display:none"></div>
<!--            Manejo del Nivel 1 -->
<div id="nivel1Tabla" style="display:none">
<fieldset>
<legend class="titulo_legend"></legend>

<!--<form id="formNivel1" name="formNivel1" class="validateDataForm">-->
<form id="formNivel1" name="formNivel1">
<!--     CAMPOS DINAMICOS DEL NIVEL1 -->
    <div id= "estructuraDelNivel1"></div>
    <input type="hidden" name="token" value="[% token %]" />

</form>
    
    <div class="textoCentrado">* [% "Campos obligatorios" | i18n %]</div>

            [% PERL %]
                    print C4::AR::Filtros::to_Button(   text    => "[% 'Guardar Nivel 1' | i18n %]",
                                                        boton   => "boton_guardar",
                                                        onClick => "guardar(1);",
                                                        title   => "[% 'Guardar el nivel 1' | i18n %]",
                                                        alternClass => "botonCentrado"
                            ) ;
            [% END %]

</fieldset>
</div>

<!--            Manejo del Nivel 2 -->
<div id="nivel2Tabla" style="display:none">
<fieldset>
<legend class="titulo_legend"></legend>
    
<!--<form id="formNivel2" name="formNivel2" class="validateDataForm">-->
<form id="formNivel2" name="formNivel2">
<!--     CAMPOS DINAMICOS DEL NIVEL 2 -->
    <div id= "estructuraDelNivel2"></div>
    <input type="hidden" name="token" value="[% token %]" />
</form>

    <div class="textoCentrado">* [% "Campos obligatorios" | i18n %]</div>

                        [% PERL %]
                                print C4::AR::Filtros::to_Button(   text    => "[% 'Guardar Nivel 2' | i18n %]",
                                                                    boton   => "boton_guardar",
                                                                    onClick => "guardar(2);",
                                                                    title   => "[% 'Guardar el nivel 2' | i18n %]",
                                                                    alternClass => "botonCentrado"
                                        ) ;
                        [% END %]

</fieldset>
</div>


<!--            Manejo del Nivel 3 -->
<div id="nivel3Tabla" style="display:none">   
<fieldset>
<legend class="titulo_legend"></legend>

<!--<form id="formNivel3" name="formNivel3" class="validateDataForm">-->
<form id="formNivel3" name="formNivel3">
	<div id="divCantEjemplares" class="divContentComponente">
		<li class="sub_item"> 
            <label for="cantEjemplares">Cant. Ejemplares: </label>
		    <input  id="cantEjemplares" type="text" tabindex="1" size="10" value="1" 
                    class="required" onClick="registrarToggleOnChangeForBarcode()"/>
        </li>
	</div>
<!--     CAMPOS DINAMICOS DEL NIVEL 3 -->
    <div id= "estructuraDelNivel3"></div>
    <input type="hidden" name="token" value="[% token %]" />

</form>

        <div class="textoCentrado">* [% "Campos obligatorios" | i18n %]</div>
     
                        [% PERL %]
                                print C4::AR::Filtros::to_Button(   text    => "[% 'Guardar Nivel 3' | i18n %]",
                                                                    boton   => "boton_guardar",
                                                                    onClick => "guardar(3);",
                                                                    title   => "[% 'Guardar el nivel 3' | i18n %]",
                                                                    alternClass => "botonCentrado"
                                        ) ;
                        [% END %]


</fieldset>
</div>

</div> <!--END <div class="centro">-->

<fieldset>
<legend class="titulo_legend">[% "Ejemplares" | i18n %]</legend>
<!-- detalle del Nivel 3, segun Nivel 2 seleccionado -->
<div id="detalleDelNivel3" class="nivel3Footer"></div>
</fieldset>

</div> <!--END <div class="todo">-->

[% INCLUDE "intranet-bottom.inc" %]

