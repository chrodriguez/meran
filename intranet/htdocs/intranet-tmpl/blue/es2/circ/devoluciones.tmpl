<!-- TMPL_INCLUDE NAME="intranet-top.inc" -->

<script src="/intranet-tmpl/blue/es2/includes/jquery/jquery.js"></script>
<script src="/intranet-tmpl/blue/es2/includes/AjaxHelper.js"></script>
<script src="/intranet-tmpl/blue/es2/includes/json/jsonStringify.js"></script>
<script src="/intranet-tmpl/blue/es2/includes/state.js"></script>
<script src="/intranet-tmpl/blue/es2/includes/util.js"></script>

<script src="/intranet-tmpl/blue/es2/includes/jquery/jquery.bgiframe.min.js"></script>
<script src="/intranet-tmpl/blue/es2/includes/jquery/jquery.autocomplete.js"></script>
<script src="/intranet-tmpl/blue/es2/includes/circulacion.js"></script>

<link href="/intranet-tmpl/blue/es2/includes/jquery/jquery.autocomplete.css" type="text/css" rel="stylesheet">

<script language="javascript" type="text/javascript">

/*
function object_usuario(){
	this.text;
	this.ID;
}*/
/*
function AutocompleteUsuario(idInput){
	// q= valor de campoHelp
	$("#"+idInput).search();
	$("#"+idInput).autocomplete('/cgi-bin/koha/autocompletables/usuarioAutocomplete.pl',{
 		formatItem: function(row){
			return row[0];
		},
		minChars:1,
        	matchSubset:1,
        	matchContains:1,
		maxItemsToShow:10,
        	cacheLength:10,
        	selectOnly:1,
	});//end autocomplete
	$("#"+idInput).result(function(event, data, formatted) {
		//muestro en el input el usuario seleccioinado
		$("#"+idInput).val(data[0]);
	
		usuario= new object_usuario();
		usuario.text= data[0];
		usuario.ID= data[1];

		detalleUsuario(data[1]);
		detallePrestamos(data[1]);
	});
}*/
/*
function updateInfoUsuario(responseText){
	
	$('#detalleUsuario').slideDown('slow');
	$('#detalleUsuario').html(responseText);
	HiddeState();

}*/
/*
function updateInfoPrestamos(responseText){
	
	$('#tablaPrestamos').slideDown('slow');
	$('#tablaPrestamos').html(responseText);
 	zebra('tablaPrestamos');
	checkedAll('checkAllPrestamos','chkboxPrestamos');
	HiddeState();

}*/

// var objAH;
/*
function detalleUsuario(borrower){

	objAH=new AjaxHelper(updateInfoUsuario, Init);
	objAH.url= '/cgi-bin/koha/circ/detalleUsuario.pl';
	objAH.borrowernumber= borrower;
	//se envia la consulta
	objAH.sendToServer();
}*/
/*
function detallePrestamos(borrower){

	objAH=new AjaxHelper(updateInfoPrestamos, Init);
	objAH.url= '/cgi-bin/koha/circ/detallePrestamos.pl';
	objAH.borrnumber= borrower;
	//se envia la consulta
	objAH.sendToServer();
}*/

// IGUAL A LA DE prestamos.tmpl, DISTINTA ACCION Y NOMBRE DE CHECKBOX!!!!!!!!!!!!!!!
// Recomiendo ponerla en un js con la de autocomplete de usuario y las otras tambien y limpiar algunas librerias.
/*
function realizarDevORen(accion){
	var chck=$("input[@name='chkbox1']:checked");
	var array= new Array;
	var long=chck.length;
	var borrowernumber=$("#borrowernumber").val();//Esta en el detalle de usuario.
	if ( long == 0){
		alert("Elija al menos un documento para devolver o renovar");
	}
	else{
		for(var i=0; i< long; i++){
			array[i]=chck[i].value;
		}
		objAH=new AjaxHelper(updateInfoReservas, Init);
		objAH.url= '/cgi-bin/koha/circ/circulacionDB.pl';
		objAH.tipoAccion= accion;
		objAH.ids3=array;
		objAH.borrowernumber=borrowernumber;
		//se envia la consulta
		objAH.sendToServer();
	}
}*/
function generaDivDevRen(responseText){
	infoArray= JSONstring.toObject(responseText);
	var html="<div class='divSeleccionPrestamos'> <p class='fontmsg'>";
	var accion=infoArray[0].accion;
	html=html + infoArray[0].accion +":<br>";
	for(var i=0; i<infoArray.length;i++){
	
		var infoDevRenObj= new infoPrestamo();
		infoDevRenObj.id3= infoArray[i].id3;
		infoDevRenObj.barcode=infoArray[i].barcode;
		infoPrestamos_array[i]= infoDevRenObj;
 
		if(infoArray[i].autor != ""){ html= html + infoArray[i].autor + ", "};
		html= html + infoArray[i].titulo + ", ";
		if(infoArray[i].unititle != ""){html= html + infoArray[i].unititle + ", "};
		if(infoArray[i].edicion != ""){html= html + infoArray[i].edicion + ". <br>"};
	}
	html= html + "</p>";
	html= html + "<center><input type='button' value='Aceptar' onClick=devolver_renovar('"+accion+"')><input type='button' value='Cancelar' onClick='cancelarDiv();'></center><br>";
	html= html + "</div>";

	$('#confirmar_div').html(html);

	HiddeState();
}

function devolver_renovar(accion){
	objAH=new AjaxHelper(updateInfoDevRen, Init);
	objAH.url= '/cgi-bin/koha/circ/circulacionDB.pl';
	objAH.tipoAccion= 'DEVOLVER_RENOVAR';
	objAH.infoDevRen= infoPrestamos_array;
	objAH.borrowernumber= usuario.ID;
	objAH.accion=accion;
	//se envia la consulta
	objAH.sendToServer();
}

function updateInfoDevRen(){
	cancelarDiv();
	detallePrestamos(usuario.ID);
}
//**************************************************************************************************************

function imprimirTicket(str,num){
	window.open ("receipt.pl"+str, "Boleta "+num,"width=650,height=550,status=no,location=no,menubar=no,personalbar=no,resizable=no,scrollbars=no");
}


<!-- TMPL_LOOP name="ticket_string" -->
 imprimirTicket("<!-- TMPL_VAR name='ticket_string' -->","<!-- TMPL_VAR name='number' -->");
<!-- /TMPL_LOOP-->



	function swap(id,src){
		document.getElementById(id).src=src;
	}

	function hacerSubmit(frm, action){
		if (frm.barcode.value!="") {
			frm.action.value= action;
			frm.submit();
		}else{
			alert("Debe completar el cï¿½digo de barras!");
		}
	}

function subirForm(){
	var formulario=document.getElementById('formReturn');
	formulario.submit;
}

function devolverItmes(){
	document.getElementById('action').value="return";
	subirForm();
}

function renovarItems(){
	document.getElementById('action').value="renew";
	subirForm();
}


//**************************************************************************************************************


$(document).ready(function() {
	//se crea el autocomplete para buscar el usuario
	AutocompleteUsuario('usuarioAutocomplete',detallePrestamos);
});

</script>

<table width="100%"  border="0" cellpadding="0" cellspacing="0" align="center">
	<tr>
		<td class="pagetitle" >
			Devoluciones y Renovaciones
		</td>
	</tr>
	<tr>
		<td class="lineagruesa"  align="left" colspan="3"></td>
	</tr>
</table>

<br>
<div id="confirmar_div"></div>
<br>

<div id="buscarUsuario">
	<table border="0" cellpadding="0" cellspacing="0"  align="center" width="100%">
		<tr class="tablaresultadoTitle">
			<td align="left" valign="top"><img src="<!-- TMPL_VAR NAME='interface' -->/<!-- TMPL_VAR name='theme' -->/images/izquierda.png">
			</td>
			<td>
				<b>Ingrese Apellido y Nombres, DNI o Legajo del usuario</b>
			</td>
			<td valign="top" align="right"><img src="<!-- TMPL_VAR NAME='interface' -->/<!-- TMPL_VAR name='theme' -->/images/derecha.png"></td>
		</tr>
		<tr><td colspan="3">&nbsp;</td></tr>
		<tr>
			<td width="1%">&nbsp;</td>
			<td align="center">
				<input id="usuarioAutocomplete" type="text" class="inputFontNormal" size="40">
			</td>
			<td width="1%">&nbsp;</td>
		</tr>
	</table>
</div>

<div id="detalleUsuario"></div>
<div id="tablaPrestamos"></div>

<!-- TMPL_INCLUDE name="intranet-bottom.inc" -->
