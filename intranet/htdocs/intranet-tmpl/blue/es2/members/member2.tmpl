<!-- TMPL_INCLUDE NAME="intranet-top.inc" -->

<script src="/intranet-tmpl/blue/es2/includes/jquery/jquery.js"></script>


<script language="javascript" type="text/javascript">

//Agrego el codigo para mostrar el estado de la busqueda en Ajax
<!-- TMPL_INCLUDE NAME="state.js" -->

<!-- TMPL_INCLUDE NAME="util.js" -->
/*
function todos(){
var checks=document.getElementsByTagName("input");
if (checks.length>0){
	for(i=0;i<checks.length;i++)
	{	
		if((checks[i].type == "checkbox")&&(checks[i].checked)){
			checks[i].checked=false
		}
		else{checks[i].checked=true}
	}
 }
}*/

function habilitar(){
	var checks=$("input[@type='checkbox']:checked");
	var array=checks.get();
	var theStatus="";
	var personNumbers=new Array();
	var cant=checks.length;
	var accion=$("#accion").val();
	if (cant>0){
		theStatus= "Usted esta a punto de "+accion+" a los propietarios de:\n"; 
	
		for(i=0;i<checks.length;i++){
			theStatus=theStatus+" -  Tarjeta nro "+ array[i].value+"\n";
			personNumbers[i]=array[i].name;
		}

		theStatus=theStatus + "\n\nEsta seguro?";
		if (cant>0){
			if (confirm (theStatus)){
				var params="cantidad="+cant+"&accion="+accion+"&personNumbers="+personNumbers;
				actualizarPersonas(params);
			}
		}
	}
	else{ alert ("No selecciono ningun usuario");}
}

function actualizarPersonas(params){
	$.ajax({type: "POST",
		url: "/cgi-bin/koha/members/actualizarPersonas.pl",
		data: params,
		beforeSend: Init,
		complete: function(ajax){
				if(ajax.responseText != ""){
					$("#msj").html(ajax.responseText);
				}
				else{$("#msj").html('');}
				consultar('');
				HiddeState();
			}
		});
}
	

//*************************************************************************************************************
var orden="surname";
function ordenar(ord){
	orden=ord;
	consultar('');
}

function consultar(ini){
	var busqueda = $('#member').val();
	var p = 'member='+busqueda+'&ini='+ini+'&orden='+orden;
	if(busqueda != ""){
		$.ajax({type: "POST",
			url: "/cgi-bin/koha/members/member2Result.pl",
			data: p,
			beforeSend: Init,
 			complete: function(ajax){
					$('#result').html(ajax.responseText);
					zebra('tablaResult');
					HiddeState();
				}
		});
	}
	else{
		alert("Ingrese un dato");
		$('#member').focus();
	}
}

function Borrar(){
	$('#member').val('');
}
function borrarMsj(){
	$("#msj").html('');
}

$(document).ready(function() {
	//onEnter con foco en input, ejecuta la busqueda
	$("#member").keypress(function (e) {
		if(e.which == 13){
			consultar('');
			borrarMsj();
		}
	});

});

</script>

<center>

<table width="100%"  border="0" cellpadding="0" cellspacing="0" align="center">
	<tr>
		<td class="pagetitle" >B&uacute;squeda de Usuarios Potenciales</td>
	</tr>
	<tr>
		<td class="lineagruesa"  align="left" colspan="3"></td>
	</tr>
</table>

<br>
<p id="msj" style="font-size:12pt; color:red"></p>

<table>
	<tr>
  		<td>
			<input id="member" type=text name="member" value="<!-- TMPL_VAR NAME=member -->">
		</td>
 		<td>
			<input id="buscar" type="image" onClick="consultar('');borrarMsj();" src="<!-- TMPL_VAR NAME='themelang' -->/images/boton-buscar.png" border='0'>

			<input type="image" onClick="Borrar();" alt="Limpiar" src="<!-- TMPL_VAR NAME='themelang' -->/images/borrar2.png" border="0" >

		</td>
	</tr>
		<tr>
		<td class="inputFontNormal" colspan=2>
			<p class="recuadroAyuda">
			Tipear el apellido, DNI o legajo del usuario. Presionar buscar.
			</p>
		</td>
	</tr>
</table>

<br>
<div id="result"></div>
</center>

<!-- TMPL_INCLUDE NAME="intranet-bottom.inc" -->

