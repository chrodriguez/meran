[% INCLUDE 'opac-top.inc' %]

<script language=javascript>

    CAMBIO_DE_CONTRASENIA= "[% 'Cambio de Contrase&ntilde;a' | i18n %]";

    function guardarCambiarPassword(claveUsuario, confirmeClave, actualPassword){

        objAH=new AjaxHelper(updateGuardarCambiarPassword);
        //objAH.debug= true;
        objAH.url= '/cgi-bin/koha/usuarios.pl';
        objAH.newpassword= claveUsuario;
        objAH.newpassword1= confirmeClave;
        objAH.actualPassword= actualPassword;
        objAH.usuario= "[% socio.getNro_socio %]";
        objAH.tipoAccion= 'CAMBIAR_PASSWORD';
        //se envia la consulta
        objAH.sendToServer();
    }

    function updateGuardarCambiarPassword(responseText){
        if (!verificarRespuesta(responseText))
                return(0);

        clearInput();
        vModificarPassword.close();
        var Messages= JSONstring.toObject(responseText);
        setMessages(Messages);
    }

    function verificarClaveUsuario(){

        var claveUsuario= $('#newpassword').val();
        var confirmeClave= $('#newpassword1').val();
        var actualPassword= $('#actualPassword').val();

        if (claveUsuario == ''){
            jAlert(POR_FAVOR_INGRESE_UNA_CONTRASENIA);
            clearInput();
            $('#newpassword').focus();
        }else{
            if (claveUsuario != confirmeClave){
                jAlert(LAS_CLAVES_SON_DISTINTAS);
                clearInput();
                $('#newpassword').focus();
            }else{
                guardarCambiarPassword(claveUsuario, confirmeClave, actualPassword);
            }
        }
}
    function cambiarPassword(){
        objAH=new AjaxHelper(updateCambiarPassword);
        objAH.url='/opac-tmpl/includes/popups/cambiarPassword.inc';
        objAH.debug= true;
        objAH.sendToServer();
    }

    function updateCambiarPassword(responseText){
        if (!verificarRespuesta(responseText))
                return(0);
        vModificarPassword=new WindowHelper({draggable: false, opacity: true});
        vModificarPassword.debug= true;
        vModificarPassword.html=responseText;
        vModificarPassword.titulo= CAMBIO_DE_CONTRASENIA;
        vModificarPassword.create();
        vModificarPassword.height('220px');
        vModificarPassword.width('550px');
        vModificarPassword.open();
        clearInput();
    }

    $(document).ready(function() {
        DetalleReservas();
        DetallePrestamos();
    });

</script>

[% INCLUDE "datos-usuario.inc" %]


<div id="marco_contenido_datos" class="contenido">

    <table class="tabla_datos" width="98%" cellspacing="0" cellpadding="4" border="0" align="center" valign="top">
        <tr>
            <td>
                <div id="detallePrestamos"></div>
            </td>
        <tr>
            <td>
                <div id="detalleReservas"></div>
            </td>
        </tr>
        <tr>
            <td>
                [% INCLUDE "sanciones.inc"%]
            </td>
        </tr>
    </table>

</div>


<!-- para mostrar los resultados de las busquedas -->
<div id="result"></div>

<div id="resultHistoriales"></div>

[% IF foto_name %]
    <form action="/cgi-bin/koha/upload.pl" method=post style="display:none">
        <input type="hidden" name="foto_name" value='[% foto_name %]' >
        <input type="hidden" name="nro_socio" value='[% socio.getNro_socio %]'>
    </form>
[% END %]

[% INCLUDE 'opac-bottom.inc' %]

