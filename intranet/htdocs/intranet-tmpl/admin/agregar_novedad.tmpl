[% INCLUDE 'intranet-top.inc' %]
<!--<link rel="stylesheet" type="text/css" media="screen,projection,print" href="/includes/css/wysiwyg.css" />-->

<style type="text/css" media="screen">
    @charset 'UTF-8';
    /*
     * jQuery File Upload UI Plugin CSS 6.2.1
     * https://github.com/blueimp/jQuery-File-Upload
     *
     * Copyright 2010, Sebastian Tschan
     * https://blueimp.net
     *
     * Licensed under the MIT license:
     * http://www.opensource.org/licenses/MIT
     */

    .fileinput-button {
      position: relative;
      overflow: hidden;
      float: left;
      margin-right: 4px;
    }
    .fileinput-button input {
      position: absolute;
      top: 0;
      right: 0;
      margin: 0;
      border: solid transparent;
      border-width: 0 0 100px 200px;
      opacity: 0;
      filter: alpha(opacity=0);
      -moz-transform: translate(-300px, 0) scale(4);
      direction: ltr;
      cursor: pointer;
    }

    /* Fix for IE 6: */
    *html .fileinput-button {
      line-height: 22px;
      margin: 1px -3px 0 0;
    }

    /* Fix for IE 7: */
    *+html .fileinput-button {
      margin: 1px 0 0 0;
    }
    
    #imagesList {
        margin-left: 0;
        text-align: right;
        width: 50%;
    }
</style>

<!--<script src="/includes/jquery/jquery.wysiwyg.js"></script>-->

<script type="text/javascript" language="javascript">
function MultiSelector( list_target, max ){this.list_target = list_target;this.count = 0;this.id = 0;if( max ){this.max = max;} else {this.max = -1;};this.addElement = function( element ){if( element.tagName == 'INPUT' && element.type == 'file' ){element.name = 'file_' + this.id++;element.multi_selector = this;element.onchange = function(){var new_element = document.createElement( 'input' );new_element.type = 'file';this.parentNode.insertBefore( new_element, this );this.multi_selector.addElement( new_element );this.multi_selector.addListRow( this );this.style.position = 'absolute';this.style.left = '-1000px';};if( this.max != -1 && this.count >= this.max ){element.disabled = true;};this.count++;this.current_element = element;} else {alert( 'Error: not a file input element' );};};this.addListRow = function( element ){var new_row = document.createElement( 'div' );var new_row_button = document.createElement( 'input' );new_row_button.type = 'button';new_row_button.value = 'Delete';new_row.element = element;new_row_button.onclick= function(){this.parentNode.element.parentNode.removeChild( this.parentNode.element );this.parentNode.parentNode.removeChild( this.parentNode );this.parentNode.element.multi_selector.count--;this.parentNode.element.multi_selector.current_element.disabled = false;return false;};new_row.innerHTML = element.value;new_row.appendChild( new_row_button );this.list_target.appendChild( new_row );};};
</script>

<script>

    //cantidad maxima de archivos a subir
    var fileMax = 5;
    
    
    function modificar(){
        $('#form_novedad').submit();
    }
        
    function agregar(){
        $('#form_novedad').submit();
    }
    
    function checkEliminarFotos(){
    
        var cant        = 0;
        
        $(':checkbox').each( 
            function() { 
                if($(this).attr('checked')){
                    $('#listImagesDelete').append('<input type="hidden" name="imagen_' + cant +'" value="' + $(this).attr('id') + '">');
                    cant++;
                }
            } 
        ); 
        
        $('#listImagesDelete').append('<input type="hidden" name="cantidad" value="' + cant + '">');
        
        $('#form_novedad').submit();
    
    }
    
    $(document).ready(function() {      
        
        [% IF editing %]
        
            $('.fancylink').fancybox();
        
        [% END %]
        
        var multi_selector = new MultiSelector( document.getElementById( 'imagesList' ), fileMax ); 
        multi_selector.addElement( document.getElementById( 'imagesInput' ) );
        
    });
    
</script>

[% USE HTML %]

[% IF editing %]
    <form id="form_novedad" action="[% url_prefix %]/admin/editar_novedad.pl" method="POST" class="form-horizontal" enctype="multipart/form-data">
<fieldset>
    <legend>[% "Editar novedad de OPAC" | i18n %]:</legend>
[% ELSE %]
    <form id="form_novedad" action="[% url_prefix %]/admin/agregar_novedad.pl" method="POST" class="form-horizontal" enctype="multipart/form-data">
<fieldset>
    <legend>[% "Agregar novedad de OPAC" | i18n %]:</legend>
[% END %]

                <div class="control-group">
                    <label class="control-label" for="titulo">[% "Titulo" | i18n %]</label>
                    <div class="controls">
                        <input type="text" id="titulo" required name="titulo" value="[% novedad.getTitulo %] [% titulo %]">
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label" for="categoria">[% "Categor&iacute;a" | i18n %]</label>
                    <div class="controls">
                        <input type="text" id="categoria" required name="categoria" value="[% novedad.getCategoria %] [% categoria %]">
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label" for="contenido">[% "Contenido" | i18n %]</label>
                    <div class="controls">
                        <textarea id="contenido" required name="contenido" style="width: 88.3%" >[%novedad.getContenido %] [% contenido %]</textarea>
                    </div>
                </div>

                [% IF twitter_enabled %]
                
                    <div class="control-group">
                        <div class="controls">
                            <input type="checkbox" [% IF twiter %] checked="checked" [% END %]id="check_publicar" name="check_publicar" value="publicar">[% " Publicar en Twitter" | i18n %]
                        </div>
                    </div>

                [% END %]
                
                [% IF editing %]
                
                    <div class="control-group">
                        <label class="control-label" for="links">[% "Links" | i18n %]</label>
                        <div class="controls">
                            <input type="text" id="links" name="links" value="[% novedad.getLinks %] [% links %]">
                            [% PERL %]
                            
                                print C4::AR::Filtros::setHelpInput(
                                                        text => "[% 'Ingrese los links separados por espacio.' | i18n %]",
                                
                                );
                            
                            [% END %]
                        </div>
                    </div>
                    <input type="hidden" id="action" name="action" value="editar">
                    <input type="hidden" id="token" name="token" value="[% token %]">
                    <input type="hidden" id="novedad_id" name="novedad_id" value="[% novedad.id %]">
 
                    [% IF cant_novedades %]
                
                    <div class="control-group">
                        <label class="control-label" >[% "Imagen/es a eliminar" | i18n %]</label>
                        <div class="controls">
                            [% FOREACH imagen IN imagenes_hash %]
	                            <a class="fancylink" id="imagen_[% imagen.getImageName %]" rel="group" href="http://[% SERVER_ADDRESS %]/opac-tmpl/uploads/novedades/[% imagen.getImageName %]">
                                    <img border="0" src="http://[% SERVER_ADDRESS %]/opac-tmpl/uploads/novedades/[% imagen.getImageName %]"
                                          style="width: 60%; max-width: 120px;" 
                                          alt="[% socio.persona.getApellido %], [% socio.persona.getNombre %] ([% socio.getNro_socio %])"
                                          title="[% socio.persona.getApellido %], [% socio.persona.getNombre %] ([% socio.getNro_socio %])"
                                    >
                                </a>
                                <input type="checkbox" name="eliminar_imagen_[% imagen.getId %]"  id="[% imagen.getImageName %]" />
	                        [% END %]

                        </div>
                        <div id="listImagesDelete"></div>
                    </div>
                    
                    [% END %]
                    
                    <div id="divImages" class="accordion">
                        <div class="accordion-group">
                            <div class="accordion-heading">
                                <a class="accordion-toggle" href="#addImages" data-parent="#divImages" data-toggle="collapse"> Agregar nuevas imagenes </a>
                            </div>
                                
                            <div id="addImages" class="accordion-body collapse">
                                <div class="accordion-inner">
                                
                                    <div class="control-group">
                                        <label class="control-label" for="contenido">[% "Imagen/es" | i18n %]</label>
                                        <div class="controls">
                                            <!-- The fileinput-button span is used to style the file input field as button -->
                                            <span class="btn btn-success fileinput-button">
                                                <span><i class="icon-plus icon-white"></i>[% " Agregar archivos..." | i18n %]</span>
                                                <input type="file" id="imagesInput">
                                            </span>
                                        </div>
                                        
                                        <div id="imagesList"></div>
                                        
                                    </div>
                                
                                </div>
                            </div>
                        </div>
                    </div>
                
                
                [% ELSE %]
                
                    <div class="control-group">
                        <label class="control-label" for="links">[% "Links" | i18n %]</label>
                        <div class="controls">
                            <input type="text" id="links" name="links" value="[% novedad.getCategoria %]">
                            [% PERL %]
                            
                                print C4::AR::Filtros::setHelpInput(
                                                        text => "[% 'Ingrese los links separados por espacio.' | i18n %]",
                                
                                );
                            
                            [% END %]
                        </div>
                    </div>
                
                    <div class="control-group">
                        <label class="control-label" >[% "Imagen/es" | i18n %]</label>
                        <div class="controls">
                            <!-- The fileinput-button span is used to style the file input field as button -->
                            <span class="btn btn-success fileinput-button">
                                <span><i class="icon-plus icon-white"></i>[% " Agregar archivos..." | i18n %]</span>
                                <input type="file" id="imagesInput">
                            </span>
                        </div>
                        
                        <div id="imagesList"></div>
                        
                    </div>
                    <input type="hidden" id="action" name="action" value="agregar">
                    
                [% END %]
            
                <input type="hidden" id="token" name="token" value="[% token %]">
                <div class="form-actions">
                [% IF editing %]
                
                    [% PERL %]
                          print C4::AR::Filtros::action_link_button( 
                                                          button    => "btn",
                                                          url       => "[% url_prefix %]/admin/novedades_opac.pl",
                                                          title     => "[% 'Volver al listado' | i18n %]",
                                                      ) ;

                    [% END %]
                    
                    [% PERL %]
                          print C4::AR::Filtros::action_button( 
                                                            button      => "btn btn-primary",
                                                            action      => "checkEliminarFotos()", 
                                                            title       => "[% 'Modificar' | i18n %]",
                                                          ) ;


                    [% END %]
                    
                [% ELSE %]
                
                    [% PERL %]
                          print C4::AR::Filtros::action_link_button( 
                                                          button    => "btn",
                                                          url       => "[% url_prefix %]/admin/novedades_opac.pl",
                                                          title     => "[% 'Volver al listado' | i18n %]",
                                                      ) ;

                    [% END %]
                    <button class="btn btn-primary" type="submit">[% 'Agregar' | i18n %]</button>
                    
                [% END %]
                </div>
            </form>
</fieldset>

[% INCLUDE 'intranet-bottom.inc' %]
