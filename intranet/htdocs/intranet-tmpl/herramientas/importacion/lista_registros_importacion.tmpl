<script type="text/javascript">

    $(document).ready(function() {
          makeToggle('datos_tabla_div_importacion','trigger',null,false);
          makeToggle('filtro_importacion','trigger',null,true);
    });

</script>

<fieldset class="resultados_busqueda">
    <legend class="titulo_legend trigger click">[% "Registros de la Importaci&oacute;n:" | i18n %]</legend>

<fieldset class="resultados_busqueda">
    <legend class="titulo_legend trigger click">[% "Filtrar" | i18n %]</legend>
        <div class="filtro_importacion">
            <ul>
                <li><input type="radio" name="record_filter" value="MAIN" [% IF record_filter == 'MAIN' or !record_filter %] checked [% END %]onChange="detalleImportacion([% id_importacion %]);">Registros Principales</li>
                <li><input type="radio" name="record_filter" value="ALL" [% IF record_filter == 'ALL' %] checked [% END %] onChange="detalleImportacion([% id_importacion %]);">Todos</li>
                <li><input type="radio" name="record_filter" value="UNIDENTIFIED" [% IF record_filter == 'UNIDENTIFIED' %] checked [% END %] onChange="detalleImportacion([% id_importacion %]);">Registros Sin Identificar</li>
                <li><input type="radio" name="record_filter" value="MATCH" [% IF record_filter == 'MATCH' %] checked [% END %] onChange="detalleImportacion([% id_importacion %]);">Registros Encontrados</li>
                <li><input type="radio" name="record_filter" value="IGNORED" [% IF record_filter == 'IGNORED' %] checked [% END %] onChange="detalleImportacion([% id_importacion %]);">Registros Ignorados</li>
            </ul>
        </div>
</fieldset>

        <div class="contenedor_paginador">[% paginador %]</div>
        <div class="datos_tabla_div_importacion">
            <div class="resultados_consulta">[% "La cantidad de registros es" | i18n %]: [% cantidad %]</div>
            
            [% PERL %]
                print C4::AR::Filtros::tableHeader(   
                                  id              => "tablaResult",
                                  columns         => ['[% "T&iacute;itulo"|i18n %]',
													  '[% "Autor"|i18n %]',
													  '[% "Identificaci&oacute;n"|i18n %]',
													  '[% "Tipo"|i18n %]',
													  '[% "Encontrado"|i18n %]',
													  '[% "Ignorado"|i18n %]',
													  '[% "Acciones"|i18n %]',
                                                     ]
                                        );
            [% END %]

            <tbody>

            [% FOREACH detalle_importacion IN resultsloop %]
                <tr>
                      <td>
                            [% detalle_importacion.getTitulo %]
                      </td>
                      <td>
                            [% detalle_importacion.getAutor %]
                      </td>
                      <td>
                           [% detalle_importacion.getIdentificacion %]
                      </td>
                      <td>
                           [% detalle_importacion.getTipo %]
                          [% IF detalle_importacion.getTipo == "Registro" %] ([% detalle_importacion.getCantidadDeRegistrosHijo %] registros)[% END %]
                      </td>

                      <td>
                        [% IF detalle_importacion.getMatching %]
							[% PERL %]
                            print C4::AR::Filtros::link_to( text =>     "Si",
                                                            url=>"[% url_prefix %]/catalogacion/estructura/detalle.pl", 
                                                            params =>   ["id1=[% detalle_importacion.getIdMatching %]"],
                                                            title =>    "[% 'Mostrar Detalle del Registro' | i18n %]",
                                                            class => "rojo"
                                                        ) ;
							[% END %]
                      <div class="click">
                            [% PERL %]
                            print C4::AR::Filtros::to_Icon(
                                                             boton         => "icon_borrar",
                                                             onClick       => "quitarMatcheoRegistro('[% detalle_importacion.getIdImportacionIso %]','[% detalle_importacion.getId %]');",
                                                             title         => "[% 'No es el mismo registro' | i18n %]",
                                                             alternClass   => "botonCentradoTabla",
                                                           ) ;

                            [% END %]
                        </div>
                        [% ELSE %]
							<span class='verde'>No</span>
                        [% END %]
                      </td>
                      <td>
                        [% IF detalle_importacion.getEstado == "I" %]<span class='rojo'>Si</span>[% ELSE %]<span class='verde'>No</span>[% END %]
                      </td>

                      <!--  BOTONES ACCIONES (Editar, Borrar, Ver detalle) -->
                      <td>
                      <div>
						   [% IF detalle_importacion.getEstado != "I" %]
                              [% PERL %]
                               print C4::AR::Filtros::action_set_button(    
									title           => "[% 'Registro' | i18n %]",
                                    button          => 'btn btn-primary',
                                    action			=> 'detalleRegistroMARC("[% detalle_importacion.getId %]")',
                                    actions         => [
										{title => "Detalle", action=>'detalleRegistroMARC("[% detalle_importacion.getId %]")',icon=>"icon-search"},
                                        {title => "Ignorar", action=>'cambiarEstadoRegistro("[% detalle_importacion.getIdImportacionIso %]","[% detalle_importacion.getId %]","I")', icon=>"icon-ban-circle"},
                                                       ],
								);
                              [% END %]
                           [% ELSE %]
                              [% PERL %]
                               print C4::AR::Filtros::action_set_button(    
									title           => "[% 'Registro' | i18n %]",
                                    button          => 'btn btn-primary',
                                    action			=> 'detalleRegistroMARC("[% detalle_importacion.getId %]")',
                                    actions         => [
										{title => "Detalle", action=>'detalleRegistroMARC("[% detalle_importacion.getId %]");',icon=>"icon-search"},
                                        {title => "Procesar", action=>'cambiarEstadoRegistro("[% detalle_importacion.getIdImportacionIso %]","[% detalle_importacion.getId %]","I");', icon=>"icon-ok-circle"},
                                                       ],
								);
                              [% END %]
						   [% END %]
                       </div>
                      
                      </td>
                </tr>
            [% END %]
            </tbody>
            </table>
        </div>
</fieldset>

<div id="detalleRegistroMARC"></div>

<div class="buttonContainerHorizontal">
    <ul class="horizontal-list" >
                [% PERL %]
                                    print C4::AR::Filtros::to_Button(   text    => "[% 'Comenzar Importaci&oacute;n' | i18n %]",
                                                                        boton   => "thoughtbot",
                                                                        onClick => "comenzarImportacion('[% id_importacion %]');",
                                                                        title   => "[% 'Comenzar Importaci&oacute;n' | i18n %]",
                                            ) ;
                [% END %]
  </ul>
</div>
